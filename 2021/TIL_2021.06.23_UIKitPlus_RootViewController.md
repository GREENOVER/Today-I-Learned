## TIL (Today I Learned)

### 6ì›” 23ì¼ (ìˆ˜)

- #### [í•™ìŠµë‚´ìš©]
  
  #### UIKitPlus - RootViewControllerì— ëŒ€í•œ í•™ìŠµğŸ§‘ğŸ»â€ğŸ’»   
  
  ##### RootViewController?   
  ë£¨íŠ¸ ë„¤ë¹„ê²Œì´ì…˜ ë·° ì»¨íŠ¸ë¡¤ëŸ¬ì˜ í˜¸ì¶œê³¼ ì‚¬ìš©ë²•ì— ëŒ€í•´ ì–´ë–»ê²Œ êµ¬ì„±ë˜ëŠ”ì§€ ë‹¨ê³„ë³„ë¡œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤.   

  1. RootViewController íŒŒì¼ ìƒì„± ë° ì •ì˜   
    - RootViewController.swift íŒŒì¼ì„ ìƒì„±í•˜ê³  RootController<DeeplinkType>ì„ ì•„ë˜ì™€ ê°™ì´ ìƒì†í•˜ì—¬ í•„ìš” ê¸°ëŠ¥ì„ ì •ì˜   
  ```swift
  import UIKitPlus
  class RootViewController: SwifRootViewController<DeeplinkType> {
    // ì•± ì‹œì‘ì‹œ ì´ˆê¸° ë·° ì»¨íŠ¸ë¡¤ëŸ¬ í‘œì‹œ
    override var splashScreen: UIViewController {
        SplashViewController() // ì •ì˜ ê°€ëŠ¥
    }
    // showLoginScreenì—ì„œ ì‚¬ìš©ìê°€ ì´ë™í•  ìœ„ì¹˜
    override var loginScreen: UIViewController {
        LoginViewController() // ì •ì˜ ê°€ëŠ¥
    }
    // switchToLogoutì—ì„œ ì‚¬ìš©ìê°€ ì´ë™í•  ìœ„ì¹˜
    override var logoutScreen: UIViewController {
        LoginViewController() // ì •ì˜ ê°€ëŠ¥
    }
    // ì¸ì¦ëœ ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì¤„ ë©”ì¸ ë·° ì»¨íŠ¸ë¡¤ëŸ¬
    override var mainScreen: UIViewController {
        MainViewController() // ì •ì˜ ê°€ëŠ¥
    }
    // ë©”ì¸ ë·° ì•ì— í‘œì‹œ
    override var onboardingScreen: UIViewController? {
        // ë°˜í™˜í•˜ì—¬ ìŠ¹ì¸ ì§í›„ í‘œì‹œ
        nil
    }
    // ìŠ¹ì¸ í™•ì¸ í›„ ì ì ˆí•œ í™”ë©´ ë°˜í™˜
    override var initialScreen: UIViewController {
        Session.shared.isAuthorized ? splashScreen : loginScreen
    }
    // ë”¥ë§í¬ ì²˜ë¦¬
    override func handleDeepLink(type: DeeplinkType) {
        /// ë”¥ë§í¬ë¥¼ ë‹¤ë£° ìŠ¤ìœ„ì¹˜/ì¼€ì´ìŠ¤ ì¡°ê±´ì— ë”°ë¼ ë”¥ ë§í¬ í™•ì¸
        /// ë§ëŠ” ë·° ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ì´ë™ êµ¬í˜„
    }
  }
  ```
  2. windowì˜ RootController ì„¸íŒ… (AppDelegate)   
  ```swift
  @UIApplicationMain
  class AppDelegateBase: UIResponder, UIApplicationDelegate {
    var window: UIWindow?
  
    func application(_ application: UIApplication, didFinishLaunchingWithOptions   launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        if #available(iOS 13.0, *) {
            // use scene delegate
        } else {
            window = UIWindow(frame: UIScreen.main.bounds)
            RootViewController().attach(to: window)
        }
        ShortcutParser.shared.registerShortcuts()
        return true
    }
  }
  ```
  3. SceneDelegate ì„¤ì •   
  ```swift
  @available(iOS 13.0, *)
  class SceneDelegate: UIResponder, UIWindowSceneDelegate {
    var window: UIWindow?
  
    func scene(_ scene: UIScene, willConnectTo session: UISceneSession, options connectionOptions: UIScene.ConnectionOptions) {
        guard let _ = (scene as? UIWindowScene) else { return }
        window = RootViewController().attach(to: scene)
    }
  } 
  ```
  4. í™”ë©´ì „í™˜   
    - UIView, UIViewController, UIApplicationDelegateì—ì„œ ì„¤ì •í•œ RootViewControllerë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆìŒ   
  ```swift
  rootController.switch(to: .login, animation: .none)
  rootController.switch(to: .main, animation: .fade)
  rootController.switch(to: .logout, animation: .dismiss)
  ```
  Deep Link ì„¤ì •   
  ```swift
  import Foundation
  import UIKit
  
  enum ShortcutKey: String {
    case activity = "com.yourapp.activity"
    case messages = "com.yourapp.messages"
  }
  
  class ShortcutParser {
    static let shared = ShortcutParser()
    private init() { }
  
    func registerShortcuts() {
        let activityIcon = UIApplicationShortcutIcon(type: .invitation)
        let activityShortcutItem = UIApplicationShortcutItem(type: ShortcutKey.activity.rawValue, localizedTitle: "Recent Activity", localizedSubtitle: nil, icon:  activityIcon, userInfo: nil)
    
        let messageIcon = UIApplicationShortcutIcon(type: .message)
        let messageShortcutItem = UIApplicationShortcutItem(type: ShortcutKey.messages.rawValue, localizedTitle: "Messages", localizedSubtitle: nil, icon: messageIcon, userInfo: nil)
    
        UIApplication.shared.shortcutItems = [activityShortcutItem, messageShortcutItem]
    }
    
    func handleShortcut(_ shortcut: UIApplicationShortcutItem) -> DeeplinkType? {
        switch shortcut.type {
        case ShortcutKey.activity.rawValue:
            return  .activity
        case ShortcutKey.messages.rawValue:
            return  .messages
        default:
            return nil
        }
    }
  }
  ```
  Deep Link Manager ì„¤ì •   
  ```swift
  import UIKitPlus
  
  // ë”¥ë§í¬ ì—´ê±° íƒ€ì… ì„¤ì •
  enum DeeplinkType {
    case messages
    case activity
  }
  
  let Deeplinker = DeepLinkManager()
  class DeepLinkManager {
    fileprivate init() {}
  
    private var deeplinkType: DeeplinkType?
    
    @discardableResult
    func handleShortcut(item: UIApplicationShortcutItem) -> Bool {
        deeplinkType = ShortcutParser.shared.handleShortcut(item)
        return deeplinkType != nil
    }
    
    // ê¸°ì¡´ ë”¥ë§í¬ë¥¼ í™•ì¸ í›„ ì‘ì—… ìˆ˜í–‰
    func checkDeepLink() {
        if let rootViewController = AppDelegate.shared.rootViewController as? RootViewController {
            rootViewController.deeplink = deeplinkType
        }
    
        // ì‘ì—… ì²˜ë¦¬ í›„ ë”¥ë§í¬ ì¬ì„¤ì •
        self.deeplinkType = nil
    }
  }
  ```
  AppDelegate ë° ìœ„ì™€ ê°™ì€ SceneDelegate ì„¤ì •   
  ```swift
  @UIApplicationMain
  class AppDelegateBase: UIResponder, UIApplicationDelegate {
    var window: UIWindow?
  
    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {
        if #available(iOS 13.0, *) {
            // SceneDelegate ì‚¬ìš©
        } else {
            window = UIWindow(frame: UIScreen.main.bounds)
            RootViewController().attach(to: window)
        }
        ShortcutParser.shared.registerShortcuts()
        return true
    }
    func applicationDidBecomeActive(_ application: UIApplication) {
        super.applicationDidBecomeActive(application)
        Deeplinker.checkDeepLink()
    }
    
    // MARK: Shortcuts
    func application(_ application: UIApplication, performActionFor shortcutItem: UIApplicationShortcutItem, completionHandler: @escaping (Bool) -> Void) {
        completionHandler(Deeplinker.handleShortcut(item: shortcutItem))
    }
    
    // MARK: UISceneSession Lifecycle
    @available(iOS 13.0, *)
    func application(_ application: UIApplication, configurationForConnecting connectingSceneSession: UISceneSession, options: UIScene.ConnectionOptions) -> UISceneConfiguration {
        UISceneConfiguration(name: "Default Configuration", sessionRole: connectingSceneSession.role)
    }
    
    @available(iOS 13.0, *)
    func application(_ application: UIApplication, didDiscardSceneSessions sceneSessions: Set<UISceneSession>) {}
  }
  ```

##### [ì°¸ê³ ìë£Œ]   
https://github.com/MihaelIsaev/UIKitPlus   
https://github.com/MihaelIsaev/UIKitPlus/blob/master/Docs/RootViewController.md
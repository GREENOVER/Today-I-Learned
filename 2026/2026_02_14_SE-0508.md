# [SE-0508] Array expression trailing closures

ì•ˆë…•í•˜ì„¸ìš”. **ê·¸ë¦°**ì…ë‹ˆë‹¤ ğŸ

ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” **SE-0508 Array expression trailing closures**ì— ëŒ€í•´ ì •ë¦¬í•´ë³´ê² ìŠµë‹ˆë‹¤ ğŸ™‹ğŸ»

![](https://blog.kakaocdn.net/dna/HVeWe/dJMcafSRrXb/AAAAAAAAAAAAAAAAAAAAAAJs8xe3OesyH7G7W1XDSR4hjebY9WlA3bmv9Pxgk_Lk/img.jpg?credential=yqXZFxpELC7KVnFOS48ylbz2pIh7yKj8&expires=1769871599&allow_ip=&allow_referer=&signature=jkxk7U0mSLO2OahDrayZVRhZg5E%3D)

---

## **Intro**

Swiftì—ì„œ trailing closureëŠ” ì •ë§ ìì£¼ ì“°ëŠ” ë¬¸ë²•ì´ì£ .

ê·¸ëŸ°ë° arrayë‚˜ dictionary íƒ€ì… ë’¤ì—ëŠ” trailing closureë¥¼ ì“¸ ìˆ˜ ì—†ë‹¤ëŠ” ê±¸ ì•„ì…¨ë‚˜ìš”?

`[String]` ê°™ì€ íƒ€ì… ë’¤ì— ì¤‘ê´„í˜¸ë¥¼ ì“°ë©´ íŒŒì„œê°€ ì œëŒ€ë¡œ ì¸ì‹í•˜ì§€ ëª»í•´ì„œ ì—ëŸ¬ê°€ ë°œìƒí•©ë‹ˆë‹¤.

ì´ë²ˆ SE-0508ì€ ë°”ë¡œ ì´ ì œì•½ì„ í’€ì–´ì£¼ëŠ” ì œì•ˆì…ë‹ˆë‹¤.

ì´ë¯¸ **Accepted** ìƒíƒœì´ê³  êµ¬í˜„ë„ ì™„ë£Œë˜ì—ˆìœ¼ë‹ˆ, ê³§ ì‹¤ë¬´ì—ì„œë„ ì“¸ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤ ğŸš€

---

## **ì™œ í•„ìš”í•œê°€?**

Arrayì— trailing closureë¥¼ ë°›ëŠ” `init`ì„ ì •ì˜í•˜ëŠ” ê±´ ê½¤ í•©ë¦¬ì ì¸ ë””ìì¸ì…ë‹ˆë‹¤.

ì˜ˆë¥¼ ë“¤ì–´ `@ArrayBuilder` result builderê°€ ìˆë‹¤ë©´:

```swift
extension Array {
    init(@ArrayBuilder build: () -> [Element]) {
        self = build()
    }
}
```

ë˜ëŠ” `nil`ì„ ë°˜í™˜í•  ë•Œê¹Œì§€ elementë¥¼ ìƒì„±í•˜ëŠ” `init`:

```swift
extension Array {
    init(generate: () -> Element?) {
        self = []
        while let element = generate() {
            append(element)
        }
    }
}
```

### **í•˜ì§€ë§Œ ì´ë ‡ê²Œ ì“¸ ìˆ˜ ì—†ìŠµë‹ˆë‹¤**

ëŒ€ë¶€ë¶„ì˜ ê²½ìš° closureë¥¼ ë°›ëŠ” `init`ì€ trailing closure ë¬¸ë²•ìœ¼ë¡œ í˜¸ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ê·¸ëŸ°ë° `Array`ë‚˜ `Dictionary` íƒ€ì…ì—ì„œëŠ” íŒŒì„œê°€ ì´ë¥¼ í—ˆìš©í•˜ì§€ ì•Šì•„ìš”.

```swift
// error: 'let' declarations cannot be computed properties
let value = [String] {
  "a"
}

// error: variable with getter/setter cannot have an initial value
var value = [String] {
  "a"
}

// error: closure expression is unused
let value = [String]
{
  "a"
}
```

ëŒ€ì‹  ì´ë ‡ê²Œ ì¨ì•¼ í•©ë‹ˆë‹¤:

```swift
let value = [String].init {
  "a"
}

let value = [String]() {
  "a"
}
```

### **InlineArrayëŠ” ëœë‹¤?**

í¥ë¯¸ë¡­ê²Œë„ `InlineArray`ì—ì„œëŠ” trailing closureê°€ **ì´ë¯¸ ì§€ì›ë©ë‹ˆë‹¤**:

```swift
let powersOfTwo = [4 of Int] { index in
  1 << index
}
```

> `Array`ì™€ `Dictionary`ì—ì„œë§Œ ì•ˆ ë˜ëŠ” ê±´ ë¶ˆí•„ìš”í•œ ì œì•½ì´ê³ , `InlineArray`ì™€ë„ ì¼ê´€ì„±ì´ ì—†ìŠµë‹ˆë‹¤.

---

## **ì œì•ˆëœ í•´ê²°ì±…**

Array íƒ€ì…ê³¼ dictionary íƒ€ì… ë’¤ì— trailing closureë¥¼ ì“¸ ìˆ˜ ìˆê²Œ í•©ë‹ˆë‹¤.

```swift
let value = [String] {
  "a"
}

let value = [String: Int] {
  (key: "a", value: 42)
}
```

ì´ì œ ì´ëŸ° ì½”ë“œê°€ ì •ìƒì ìœ¼ë¡œ íŒŒì‹±ë˜ê³  ì»´íŒŒì¼ë©ë‹ˆë‹¤!

---

## **ì–´ë–»ê²Œ ë™ì‘í•˜ë‚˜?**

í˜„ì¬ íŒŒì‹± ë™ì‘ì„ ì´í•´í•˜ë ¤ë©´ ë‘ ê°€ì§€ë¥¼ ì•Œì•„ì•¼ í•©ë‹ˆë‹¤.

### **1. `[...]`ëŠ” í•­ìƒ literalë¡œ íŒŒì‹±ë¨**

í‘œí˜„ì‹ì„ íŒŒì‹±í•  ë•Œ `[...]` í† í°ì€ í•­ìƒ arrayë‚˜ dictionary **literal**ë¡œ íŒŒì‹±ë©ë‹ˆë‹¤.

`[String]`ì´ë‚˜ `[String: Int]` ê°™ì€ ê²½ìš°, í•„ìš”í•˜ë©´ íƒ€ì… ì²´í¬ ë‹¨ê³„ì—ì„œ array/dictionary **íƒ€ì…**ìœ¼ë¡œ ë³€í™˜ë©ë‹ˆë‹¤.

`[String]`ì´ ì‹¤ì œë¡œëŠ” `let String = "a"` í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•˜ëŠ” ë‹¨ì¼ ìš”ì†Œ array literalì¼ ìˆ˜ë„ ìˆìœ¼ë‹ˆê¹Œìš”.

### **2. ì¤‘ê´„í˜¸ëŠ” trailing closure... ë‹¨ literal ë’¤ëŠ” ì œì™¸**

í‘œí˜„ì‹ ë’¤ì— `{` í† í°ì´ ì˜¤ë©´ trailing closureë¡œ í•´ì„ë©ë‹ˆë‹¤.

**ë‹¨, ì´ì „ í‘œí˜„ì‹ì´ literalì¸ ê²½ìš°ëŠ” ì œì™¸**ì…ë‹ˆë‹¤.

Swift 5.2ì—ì„œ `callAsFunction`ì´ ë„ì…ë˜ê¸° ì „(SE-0253)ê¹Œì§€ëŠ” ì´ê²Œ í•©ë¦¬ì ì´ì—ˆìŠµë‹ˆë‹¤.

literal ë’¤ì— trailing closureê°€ ì˜¬ validí•œ ì¼€ì´ìŠ¤ê°€ ì—†ì—ˆê±°ë“ ìš”.

### **í•´ê²° ë°©ë²•**

Arrayì™€ dictionary literal ë’¤ì— trailing closureë¥¼ í—ˆìš©í•˜ë„ë¡ ë³€ê²½í•©ë‹ˆë‹¤.

ì´ë ‡ê²Œ í•˜ë©´ ì´ëŸ° `init(_:)` trailing closure ì˜ˆì‹œê°€ ì œëŒ€ë¡œ íŒŒì‹±ë˜ê³  ì»´íŒŒì¼ë©ë‹ˆë‹¤:

```swift
let value = [String] {
  "a"
}

let value = [String: Int] {
  (key: "a", value: 42)
}
```

### **ë¶€ìˆ˜ íš¨ê³¼: callAsFunctionë„ ì§€ì›**

ê²°ê³¼ì ìœ¼ë¡œ `callAsFunction` trailing closureë„ ì§€ì›ë©ë‹ˆë‹¤:

```swift
extension Array {
    func callAsFunction<T>(mapElement: (Element) -> T) -> [T] {
        map(mapElement)
    }
}

let value = ["a", "b", "c"] {
    $0.uppercased()
}
```

> ì‘ì€ ë¹„ìš©ìœ¼ë¡œ ì–¸ì–´ì˜ í‘œí˜„ë ¥ê³¼ ì¼ê´€ì„±ì´ í¬ê²Œ í–¥ìƒë©ë‹ˆë‹¤.

---

## **í˜¸í™˜ì„±**

### **Source compatibility**

ì´ íŒŒì‹± ë³€ê²½ì€ array literal ë’¤ì— ì˜¤ëŠ” ê¸°ì¡´ closure literalì˜ ì˜ë¯¸ë¥¼ ë°”ê¿‰ë‹ˆë‹¤.

í•˜ì§€ë§Œ í˜„ì¬ ì‹¤ì œë¡œ ì»´íŒŒì¼ë˜ëŠ” ì¼€ì´ìŠ¤ëŠ” ê±°ì˜ ì—†ì–´ìš”.

ëŒ€ë¶€ë¶„ì€ `closure expression is unused` ì—ëŸ¬ê°€ ë‚©ë‹ˆë‹¤:

```swift
["a", "b", "c"] { // error: closure expression is unused
  "a"
}

["a", "b", "c"]
{ "a" } // error: closure expression is unused
```

### **ì—ëŸ¬ê°€ ì•ˆ ë‚˜ëŠ” ìœ ì¼í•œ ì¼€ì´ìŠ¤**

Closureë¥¼ ë°›ëŠ” result builderì—ì„œë§Œ ì—ëŸ¬ê°€ ì•ˆ ë‚©ë‹ˆë‹¤:

```swift
@resultBuilder
enum FunctionArrayBuilder {
    static func buildBlock(_ components: (() -> Void)...) -> [() -> Void] {
        components
    }
}

@FunctionArrayBuilder
var buildFunctions: [() -> Void] {
    let array = ["a", "b", "c"]
    { print(array) }
}
```

ì´ ì½”ë“œëŠ” ì´ì œ ì»´íŒŒì¼ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ result builder ì¼€ì´ìŠ¤ëŠ” ì´ë¯¸ ë§¤ìš° ì·¨ì•½í•˜ê³  ë¹„ì‹¤ìš©ì ì…ë‹ˆë‹¤.

#### **ì™œ ì·¨ì•½í•œê°€?**

1. **ì—°ì†ëœ closure literalì€ ì„¸ë¯¸ì½œë¡  ì—†ì´ ì§€ì› ì•ˆ ë¨**

```swift
@FunctionArrayBuilder
var buildFunctions: [() -> Void] {
    { print("a") }
    { print("b") } // error: extra trailing closure passed in call
}
```

2. **ì‘ì€ ë³€ê²½ìœ¼ë¡œë„ ì»´íŒŒì¼ì´ ê¹¨ì§**

```swift
// Compiles
@FunctionArrayBuilder
var buildFunctions: [() -> Void] {
    let array = ["a", "b", "c"]
    { print(array) };
    { print(array.count) }
}
```

```swift
// Doesn't compile
@FunctionArrayBuilder
var buildFunctions: [() -> Void] {
    let array = ["a", "b", "c"]
    let count = array.count
    { print(array) }; // error: cannot convert value of type '()' to closure result type 'Bool'
    { print(count) }
}
```

3. **callAsFunctionì´ ìˆìœ¼ë©´ ì˜ë¯¸ê°€ ë°”ë€œ**

```swift
extension Int {
  func callAsFunction(_ closure: () -> Void) -> Int {
    closure()
    return self
  }
}

@FunctionArrayBuilder
var buildFunctions: [() -> Void] {
    let array = ["a", "b", "c"]
    let count = array.count
    { print(array) }; // callAsFunction trailing closure, not an accumulated result builder value
    { print(count) }
}
```

> ì´ëŸ° ì¼€ì´ìŠ¤ëŠ” ì‹¤ì œë¡œ ì‚¬ìš©ë˜ëŠ” ì˜ˆì‹œê°€ ì—†ê³ , ë” ë³µì¡í•œ íŒŒì‹± ê·œì¹™ìœ¼ë¡œ ìˆ˜ìš©í•˜ëŠ” ê²ƒë³´ë‹¤ ì´ source breakë¥¼ ë°›ì•„ë“¤ì´ëŠ” ê²Œ ë‚«ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

---

## **ABI compatibility**

ê¸°ì¡´ ì„ ì–¸ì— ëŒ€í•œ ìƒˆë¡œìš´ callsite ë¬¸ë²•ë§Œ ì¶”ê°€í•˜ëŠ” ê±°ë¼ ABIì— ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤.

---

## **í–¥í›„ ë°©í–¥**

### **ëª¨ë“  literalì— trailing closure í—ˆìš©?**

ì´ ì œì•ˆì€ arrayì™€ dictionary literalë§Œ ì§€ì›í•©ë‹ˆë‹¤.

ë” ë‚˜ì•„ê°€ì„œ **ëª¨ë“  literal**ì— trailing closureë¥¼ í—ˆìš©í•  ìˆ˜ë„ ìˆì–´ìš”.

```swift
extension String {
  func callAsFunction(_ closure: (String) -> Void) {
    closure(self)
  }
}

"Hello world" { // currently, error: closure expression is unused 
  print($0)
}
```

ë‹¤ë¥¸ trailing closure ì¼€ì´ìŠ¤ì™€ ë” ì¼ê´€ë˜ê³ , íŠ¹ë³„í•œ ë‹¨ì ë„ ì—†ìŠµë‹ˆë‹¤.

ë‹¤ë§Œ array/dictionaryë§Œí¼ ê°•ë ¥í•˜ê²Œ ë™ê¸°ë¶€ì—¬ë˜ì§€ëŠ” ì•Šì•„ìš”.

Arrayì™€ dictionaryëŠ” íƒ€ì… í‘œí˜„ì‹ì´ literalë¡œ íŒŒì‹±ë˜ëŠ” ì ì¬ì  ëª¨í˜¸ì„± ë•Œë¬¸ì— íŠ¹ë³„í•˜ê±°ë“ ìš”.

---

## **ê³ ë ¤ëœ ëŒ€ì•ˆë“¤**

### **ì¶”ê°€ íŒŒì‹± íœ´ë¦¬ìŠ¤í‹±**

#### **ê°™ì€ ì¤„ì—ì„œë§Œ í—ˆìš©?**

Source breakëŠ” array literal ë‹¤ìŒ ì¤„ì— result builder closureê°€ ì˜¤ëŠ” ê²½ìš°ì…ë‹ˆë‹¤:

```swift
@FunctionArrayBuilder
var buildFunctions: [() -> Void] {
    let array = ["a", "b", "c"]
    { print(array) }
}
```

ê°™ì€ ì¤„ì— ìˆìœ¼ë©´ ì´ë¯¸ ì»´íŒŒì¼ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤:

```swift
@FunctionArrayBuilder
var buildFunctions: [() -> Void] {
    let array1 = ["a", "b", "c"] { // error: cannot convert return expression of type '()' to return type '[String]'
        print(array)
    }

    let array2 = ["a", "b", "c"] { // error: variable with getter/setter cannot have an initial value
        ["d"]
    }
}
```

ê°™ì€ ì¤„ì¼ ë•Œë§Œ trailing closureë¡œ ì²˜ë¦¬í•˜ë©´ source breakë¥¼ í”¼í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ ì´ê±´ ë‹¤ë¥¸ ëª¨ë“  brace/trailing closure ì¼€ì´ìŠ¤ì™€ ì¼ê´€ì„±ì´ ì—†ì–´ìš”:

```swift
let array = ["a", "b", "c"].map 
{ 
  $0.uppercased()
}

if array.count >= 3
{
  print("success: \(array)")
}
```

> ì´ëŸ° ì„ì˜ì ì¸ ë¶ˆì¼ì¹˜ëŠ” ì½”ë“œ í¬ë§¤íŒ… ë„êµ¬ ê°™ì€ ìƒíƒœê³„ ì „ë°˜ì— ë³µì¡ì„±ì„ ì¶”ê°€í•©ë‹ˆë‹¤.

#### **Array íƒ€ì…ë§Œ ì§€ì›?**

Array/dictionary **íƒ€ì…**ë§Œ ì§€ì›í•˜ê³  ë‹¤ë¥¸ literalì€ ì œì™¸í•˜ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.

`[String]` íƒ€ì…ì€ validí•œ í‘œí˜„ì‹ì´ ì•„ë‹ˆë‹ˆê¹Œ source compatibility ë¬¸ì œê°€ ì—†ê² ì£ .

í•˜ì§€ë§Œ íŒŒì‹± ì‹œì ì—ëŠ” `[String]`ì´ íƒ€ì…ì¸ì§€ literalì¸ì§€ ì•Œ ìˆ˜ ì—†ìŠµë‹ˆë‹¤:

```swift
let String = "a"
let array = [String] // an array literal, ["a"]
{ print(array) }
```

ë‹¨ì¼ ìš”ì†Œ array/dictionary literalì´ê³  ë‹¨ì¼ identifierë¥¼ í¬í•¨í•˜ëŠ” ê²½ìš°ë§Œ í—ˆìš©í•  ìˆ˜ë„ ìˆì§€ë§Œ, ì´ëŸ¬ë©´ `callAsFunction` ì¼€ì´ìŠ¤ê°€ ë¶ˆí•„ìš”í•˜ê²Œ ì œê±°ë©ë‹ˆë‹¤.

---

## **Conclusion**

SE-0508ì€ ì´ë¯¸ **Accepted**ë˜ì—ˆê³  êµ¬í˜„ë„ ì™„ë£Œëœ ìƒíƒœì…ë‹ˆë‹¤.

ê°œì¸ì ìœ¼ë¡œëŠ” ì •ë§ í•©ë¦¬ì ì¸ ê°œì„ ì´ë¼ê³  ìƒê°í•´ìš”.

`InlineArray`ì—ì„œëŠ” ë˜ëŠ”ë° `Array`ì—ì„œëŠ” ì•ˆ ëœë‹¤ëŠ” ê²Œ ë§ì´ ì•ˆ ëê±°ë“ ìš”.

`@ArrayBuilder` ê°™ì€ result builderì™€ í•¨ê»˜ ì“°ë©´ ì •ë§ ê¹”ë”í•œ APIë¥¼ ë§Œë“¤ ìˆ˜ ìˆì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ì‘ì€ ë³€ê²½ì´ì§€ë§Œ ì–¸ì–´ì˜ ì¼ê´€ì„±ê³¼ í‘œí˜„ë ¥ì„ í¬ê²Œ ë†’ì—¬ì£¼ëŠ” ê°œì„ ì´ë„¤ìš” ğŸ˜ƒ

---

## **References**

[swift-evolution/proposals/0508-array-expression-trailing-closures.md at main Â· swiftlang/swift-evolution](https://github.com/swiftlang/swift-evolution/blob/main/proposals/0508-array-expression-trailing-closures.md)

[Pitch: Support trailing closure syntax for single-argument Array and Dictionary initializers - Swift Forums](https://forums.swift.org/t/support-trailing-closure-syntax-for-single-argument-array-and-dictionary-initializers/83900)

[SE-0508: Array expression trailing closures - Swift Forums](https://forums.swift.org/t/se-0508-array-expression-trailing-closures/84479)

[Accepted: SE-0508: Array expression trailing closures - Swift Forums](https://forums.swift.org/t/accepted-se-0508-array-expression-trailing-closures/84728)

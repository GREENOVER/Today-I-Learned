## TIL (Today I Learned)

### 5ì›” 18ì¼ (ëª©)    

- ### [í•™ìŠµë‚´ìš©] Tuistì˜ Configuration ì„¤ì •í•˜ê¸°

    ### ë“¤ì–´ê°€ê¸° ì „ í•„ìš” ê°œë°œ í™˜ê²½ ì²´í¬

    ê¸°ë³¸ì ìœ¼ë¡œ í”„ë¡œì íŠ¸ëŠ” DEBUGì™€ RELEASEì˜ flag ì¦‰, build configurationì„ ê°€ì§€ê²Œ ë˜ëŠ”ë°ìš”.
    ê°ì ë§Œë“¤ê³  ìˆëŠ” í”„ë¡œì íŠ¸ì˜ ì„±í–¥ì— ë”°ë¼ ë‹¤ë¥´ê² ì§€ë§Œ ì—¬ê¸°ì„œ QA configurationë„ ì¶”ê°€í•˜ì—¬ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ì‹¤ì œ ì €ëŠ” ì´ 3ê°œì˜ configurationì„ ì„¤ì •í•˜ëŠ”ë°ìš”.
    í•˜ë‚˜ëŠ” ë‚´ë¶€ ê°œë°œì˜ ë°°í¬ë¥¼ ìœ„í•œ DEV, ë˜ í•˜ë‚˜ëŠ” ì‹¤ì œ í”„ë¡œë•íŠ¸ ì¶œì‹œ ì „ QAë¥¼ ìœ„í•œ QA, ë§ˆì§€ë§‰ìœ¼ë¡œ ì‹¤ì œ ìƒìš© ë°°í¬ë¥¼ ìœ„í•œ RELEASEë¡œ ë‚˜ëˆŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    ì, ê·¸ëŸ¼ ì´ 3ê°œì˜ configurationì„ Tuistë¥¼ í†µí•´ ì–´ë–»ê²Œ ê° ë°°í¬ í™˜ê²½ì„ ì¤„ ìˆ˜ ìˆëŠ”ì§€ ê°™ì´ í•´ë³´ì‹œì£ ğŸ•ºğŸ»

    ### Tuistë¥¼ í†µí•´ Configuration ì„¤ì •í•˜ê¸°

    ë¨¼ì € ì•±ì„ êµ¬ì„±í•˜ëŠ” ëª¨ë“ˆì´ ë˜ëŠ” í”„ë¡œì íŠ¸ íƒ€ê²Ÿ ì„¤ì •ì—ì„œ ì•„ë˜ì™€ ê°™ì´ QA / DEBUG / RELASEì˜ configurationì„ ì„¤ì •í•´ì¤ë‹ˆë‹¤.
    ```swift
    let project = Project.make(
      name: "GREENUI",
      targets: [
        .make(
          name: "GREENUI",
          product: .framework,
          bundleId: "com.green.GREENUI",
          sources: ["Sources/**"],
          resources: ["Resources//**"],
          dependencies: [
          ]
        )
      ],
      // ìš” ë¶€ë¶„ì—ì„œ ì„¤ì •
      settings: .settings(
        configurations: [
          .debug(name: .debug),
          .debug(name: "QA"),
          .release(name: .release)
        ]
      )
    )
    ```
    ê¸°ë³¸ì ìœ¼ë¡œ debugì™€ releaseëŠ” ì œê³µë˜ì§€ë§Œ QA / STAGE / DEVì™€ ê°™ì´ ì´ ì™¸ ë³„ë„ë¡œ í•„ìš”í•œ ë¹Œë“œ ì„¤ì •ì€ ì§ì ‘ ë„£ì–´ì¤ë‹ˆë‹¤.

    ê·¸ ë‹¤ìŒìœ¼ë¡œ ì‹¤ì œ ì´ ê´€ì—¬í•  ì•± í”„ë¡œì íŠ¸ì—ì„œ configurationì„ ì£¼ê¸°ì „ Dependencyì—ì„œë„ ì„¤ì •ì´ í•„ìš”í•˜ê¸°ì— í•œë²ˆ í•´ë³¼ê¹Œìš”?

    ë§Œì•½ ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤ë©´ Dependecies íŒŒì¼ì—ì„œë„ configurationì„ ì„¤ì •í•´ì¤˜ì•¼ í•©ë‹ˆë‹¤.
    ê·¸ ì´ìœ ëŠ” ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ ê¸°ë³¸ì ìœ¼ë¡œ DEBUG / RELEASEì˜ configurationë§Œ ì„¤ì •ë˜ì–´ ìˆê¸°ì— ì‹¤ì œ QA configurationì„ ë¶€ì—¬í•´ì£¼ì§€ ì•Šìœ¼ë©´ ì•„ë˜ì™€ ê°™ì´ í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ê°€ì§„ configurationì€ DEBUG / RELASEì¸ë° ìš°ë¦¬ ì•± í”„ë¡œì íŠ¸ì—ì„œëŠ” QAê¹Œì§€ ì´ 3ê°œë¥¼ ì‚¬ìš©í•˜ê³  ìˆì–´ ë¯¸ìŠ¤ë§¤ì¹­ì´ ë˜ê³  ìˆë‹¤ëŠ” ì˜¤ë¥˜ê°€ ë‚©ë‹ˆë‹¤.
    ```
    Warning: The project 'Get' has missing or mismatching configurations. It has [Debug (debug), Release (release)], other projects have [DEBUG(debug), QA(debug), RELEASE(release)]
    ```

    ê·¸ë ‡ê¸°ì— ì´ ì„¤ì •ë„ ì•„ë˜ì™€ ê°™ì´ í•´ì¤˜ì•¼ í•´ìš”!
    ```swift
    import ProjectDescription
    import ProjectDescriptionHelpers

    let dependencies = Dependencies(
      swiftPackageManager: SwiftPackageManagerDependencies(
        [
          ...
          .remote(
            url: "https://github.com/firebase/firebase-ios-sdk.git",
            requirement: .exact("10.0.0")
          ),
          .remote(
            url: "https://github.com/airbnb/lottie-spm.git",
            requirement: .exact("4.1.3")
          ),
          .remote(
            url: "https://github.com/AppsFlyerSDK/AppsFlyerFramework.git",
            requirement: .exact("6.5.0")
          ),
          .remote(
            url: "https://github.com/kean/Get.git",
            requirement: .exact("2.1.1")
          ),
          ...
        ],
        // ìš” ë¶€ë¶„ì—ì„œ ë§ˆì°¬ê°€ì§€ë¡œ ì„¤ì •
        baseSettings: .settings(
          configurations: [
            .debug(name: .debug),
            .debug(name: "QA"),
            .release(name: .release)
          ]
        )
      ),
      platforms: [.iOS]
    )
    ```
    SPMì˜ baseSettings ì˜µì…˜ì„ í™œìš©í•´ ë™ì¼í•˜ê²Œ configurationì„ ì„¤ì •í•´ì¤ë‹ˆë‹¤.

    ë§ˆì§€ë§‰ìœ¼ë¡œ ìµœì¢…ì ì¸ ì•±ì˜ í”„ë¡œì íŠ¸ íŒŒì¼ì„ ê±´ë“œë ¤ ë³¼ê¹Œìš”?

    ì•„ë˜ì™€ ê°™ì´ Project íŒŒì¼ì„ ì‹¤ì œ ë°°í¬í™˜ê²½ì— ë§ê²Œ Dev / QA / PRODë¡œ êµ¬ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ```swift
    let project = Project.make(
      name: "GREENAPP",
      targets: [

        // QA íƒ€ê²Ÿ
        .make(
          name: "QA-GREENAPP",
          product: .app,
          bundleId: "com.green.qa",
          infoPlist: .file(path: .relativeToRoot("GREENAPP/Info.plist")),
          sources: ["Sources/**"],
          entitlements: .relativeToRoot("GREENAPP/Resources/QA/GREENAPP.entitlements"),
          dependencies: [
          ],
          settings: .settings(
            configurations: [
              .debug(name: "QA", xcconfig: "./xcconfigs/green.qa.xcconfig")
            ]
          )
        )

        // DEV íƒ€ê²Ÿ
        .make(
          name: "DEV-GREENAPP",
          product: .app,
          bundleId: "com.green.dev",
          infoPlist: .file(path: .relativeToRoot("GREENAPP/Info.plist")),
          sources: ["Sources/**"],
          entitlements: .relativeToRoot("GREENAPP/Resources/DEV/GREENAPP.entitlements"),
          dependencies: [
          ],
          settings: .settings(
            configurations: [
              .debug(name: .debug, xcconfig: "./xcconfigs/green.dev.xcconfig")
            ]
          )
        )

        // PROD íƒ€ê²Ÿ
        .make(
          name: "PROD-GREENAPP",
          product: .app,
          bundleId: "com.green.prod",
          infoPlist: .file(path: .relativeToRoot("GREENAPP/Info.plist")),
          sources: ["Sources/**"],
          entitlements: .relativeToRoot("GREENAPP/Resources/PROD/GREENAPP.entitlements"),
          dependencies: [
          ],
          settings: .settings(
            configurations: [
              .debug(name: .release, xcconfig: "./xcconfigs/green.prod.xcconfig")
            ]
          )
        )
      ],

      // í•´ë‹¹ Project configuration ì„¤ì •
      settings: .settings(
        configurations: [
          .debug(name: .debug),
          .debug(name: "QA"),
          .release(name: .release)
        ]
      ),
      additionalFiles: [
        "./xcconfigs/green.shared.xcconfig"
      ]
    )
    ```
    ì´ëŸ°ì‹ìœ¼ë¡œ ê° ë°°í¬í™˜ê²½ì— ë§ê²Œ íƒ€ê²Ÿì„ ë¶„ë¦¬í•˜ê³  í•´ë‹¹ íƒ€ê²Ÿì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” configurationì„ ë‹´ì•„ì¤ë‹ˆë‹¤.
    ê·¸ë¦¬ê³  í•´ë‹¹ í”„ë¡œì íŠ¸ ì „ì²´ì ìœ¼ë¡œ configurationì„ Debug / QA / Releaseë¥¼ êµ¬ì„±í•´ì£¼ë©´ ë©ë‹ˆë‹¤.

    ì—¬ê¸°ì„œ ë§ˆì§€ë§‰ìœ¼ë¡œ ì§šì–´ë³´ë©´ì„œ ì„¤ì •í•´ì•¼í•  ë¶€ë¶„ì´ ìˆì–´ìš”ğŸ™‹ğŸ»
    ë°”ë¡œ xcconfig ë¶€ë¶„ì…ë‹ˆë‹¤.

    ì‹¤ì œ xcconfig íŒŒì¼ì€ í•´ë‹¹ í”„ë¡œì íŠ¸ ë‚´ ê²½ë¡œì— ë§Œë“¤ì–´ì£¼ê³  ê° qa / dev / prodë¡œ ë¶„ë¦¬í•˜ì—¬ configuration ë³„ë¡œ í•´ë‹¹í•˜ëŠ” ë¹Œë“œ ì„¤ì •ì„ í•´ì£¼ëŠ” ìš©ë„ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    ì¦‰, ì•„ë˜ì™€ ê°™ì´ ìš°ì„ ì ìœ¼ë¡œ xcconfig íŒŒì¼ì„ ë§Œë“­ë‹ˆë‹¤.


    ì—¬ê¸°ì„œ shared.xcconfig íŒŒì¼ì—ëŠ” releas/qa/dev ê³µí†µì ìœ¼ë¡œ ë“¤ì–´ê°ˆ ì„¤ì •ì„ ë„£ì–´ì¤ë‹ˆë‹¤.
    ```
    MARKETING_VERSION=2.3.0
    CURRENT_PROJECT_VERSION=135
    DEVELOPMENT_TEAM=BLABLA
    ```
    ë§ˆì¼“íŒ… ë²„ì „ ë° ë¹Œë“œ ë„˜ë²„ ê·¸ë¦¬ê³  í•´ë‹¹ ì•±ì˜ ê°œë°œíŒ€ ID ê°’ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê² ì£ ?

    ê·¸ ë‹¤ìŒìœ¼ë¡œ ê° release/qa/debugì— ê°ì configuration ì„¤ì •ì„ ìœ„í•´ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¥¼ ë§¤ì¹­í•˜ì—¬ ì¶”ê°€í•´ì¤ë‹ˆë‹¤.
    ```
    #include "./green.shared.xcconfig"

    // dev.xcconfigì—ì„œ ì¶”ê°€
    OTHER_SWIFT_FLAGS[config=DEBUG][sdk=*] = $(inherited) -DDEBUG

    // qa.xcconfigì—ì„œ ì¶”ê°€
    OTHER_SWIFT_FLAGS[config=QA][sdk=*] = $(inherited) -DQA

    // prod.xcconfigì—ì„œ ì¶”ê°€
    OTHER_SWIFT_FLAGS[config=RELEASE][sdk=*] = $(inherited) -DRELEASE
    ```
    ê° ë°°í¬ í™˜ê²½ë³„ë¡œ Swift Flagë¥¼ ì‹¬ì–´ì£¼ëŠ” ì—­í• ì„ í•´ì¤ë‹ˆë‹¤.

    ê·¸ëŸ¼ ì´ì œ ëª¨ë“ ê²Œ ëë‚¬ìŠµë‹ˆë‹¤!

    ì‹¤ì œë¡œ í•˜ë‚˜ ë” ë‚˜ì•„ê°€ì„œ Workspaceë¥¼ ë§Œë“¤ë•Œ Dev / QA / Prod configurationìœ¼ë¡œ ìŠ¤í‚´ì„ ë¶„ë¦¬í•˜ê³  ì‚¬ìš©í•  ìˆ˜ ìˆìŒìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì´ Workspace ì„¤ì •ì„ êµ¬í˜„í•´ì¤ë‹ˆë‹¤.
    ```swift
    import ProjectDescription

    let workspace = Workspace(
      name: "GREEN",
      projects: [
        "GREENAPP",
        "GREENUI",
      ],
      schemes: [
        Scheme(
          name: "Prod-GREEN",
          buildAction: .buildAction(targets: [.project(path: "./GREENAPP", target: "Prod-GREENAPP")]),
          runAction: .runAction(configuration: .release),
          archiveAction: .archiveAction(configuration: .release),
          profileAction: .profileAction(configuration: .release),
          analyzeAction: .analyzeAction(configuration: .release)
        ),
        Scheme(
          name: "Dev-GREEN",
          buildAction: .buildAction(targets: [.project(path: "./GREENAPP", target: "Dev-GREENAPP")]),
          runAction: .runAction(configuration: .debug),
          archiveAction: .archiveAction(configuration: .debug),
          profileAction: .profileAction(configuration: .debug),
          analyzeAction: .analyzeAction(configuration: .debug)
        ),
        Scheme(
          name: "QA-GREEN",
          buildAction: .buildAction(targets: [.project(path: "./GREENAPP", target: "QA-GREENAPP")]),
          runAction: .runAction(configuration: "QA"),
          archiveAction: .archiveAction(configuration: "QA"),
          profileAction: .profileAction(configuration: "QA"),
          analyzeAction: .analyzeAction(configuration: "QA")
        ),
      ],
      generationOptions: .options(autogeneratedWorkspaceSchemes: .disabled)
    )
    ```

    ìš”ë ‡ê²Œ íë¦„ìˆœìœ¼ë¡œ êµ¬ì„±ì„ í•´ì¤€ë‹¤ë©´ ì‹¤ì œ ìŠ¤í‚´ë³„ë¡œ í…ŒìŠ¤íŠ¸ ë° ë°°í¬ë¥¼ ë³´ë‹¤ ìˆ˜ì›”í•˜ê²Œ í•  ìˆ˜ ìˆê²Œ ë˜ë©° ëª©ì ì— ë”°ë¼ ë¶„ë¦¬ê°€ ëª…í™•í•´ì§‘ë‹ˆë‹¤ğŸ˜ƒ

    ### ë§ˆë¬´ë¦¬

    ê° ë°°í¬ í™˜ê²½ë³„ ë¹Œë“œ ì„¤ì •ì€ í”„ë¡œë•íŠ¸ë¥¼ ë§Œë“¤ë‹¤ ë³´ë©´ ê¼­ í•„ìš”í•œ ë¶€ë¶„ì¸ë° ì´ë˜í•œ Tuistë¥¼ í†µí•´ ì•„ì£¼ ì‰½ê²Œ ì„¤ì •í•  ìˆ˜ ìˆëŠ”ê±¸ ì•Œì•„ë³¸ ì¢‹ì€ ê²½í—˜ì´ì˜€ìŠµë‹ˆë‹¤ğŸ™Œ
    
    ### í•´ë‹¹ í¬ìŠ¤íŒ… ë¸”ë¡œê·¸ ë§í¬   
    https://green1229.tistory.com/359   
## TIL (Today I Learned)

### 2ì›” 17ì¼ (ê¸ˆ)    

- ### [í•™ìŠµë‚´ìš©] UITextViewë¥¼ SwiftUIì—ì„œ ì»¤ìŠ¤í…€í•˜ê²Œ ì‚¬ìš©í•˜ê¸°
    #### ì™œ TextEditor ì•ˆì“°ì£ !?

    ìš°ì„  í˜„ì¬ ê¸°ì¤€ iOS 16ì—ì„œ TextEditorê°€ ë¶„ëª… ì“¸ë§Œí•´ì§„ê²ƒì€ ì‚¬ì‹¤ì…ë‹ˆë‹¤.
    ë‹¤ë§Œ ìµœì‹  ë²„ì „ì„ ì‚¬ìš©í•  ìˆ˜ ì—†ëŠ” í™˜ê²½ì— ì²˜í•œ ì—¬ëŸ¬ë¶„ë“¤ì´ ë” ë§ì„ê²ƒ ê°™ê³  ì € ì—­ì‹œ ê·¸ë ‡ìŠµë‹ˆë‹¤ğŸ˜­
    14,15 ë²„ì „ ê¸°ì¤€ìœ¼ë¡œ ê°„ë‹¨íˆ ì§šì–´ë³´ë©´ ìš°ì„  SwiftUIì˜ ê¸°ë³¸ ì œê³µë˜ëŠ” TextEditorì—ì„œëŠ” ìš°ë¦¬ê°€ í”íˆ ì‚¬ìš©í•˜ëŠ” placeholderë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µí•˜ì§€ ì•Šì•„ í•„ìš”í•˜ë©´ overlayë¡œ ì»¨íŠ¸ë¡¤ í•´ì¤˜ì•¼í•©ë‹ˆë‹¤.
    ë˜ í…ìŠ¤íŠ¸ê°€ ì…ë ¥ë˜ëŠ” ì¹¸ì˜ Insetì„ ì¡°ì •í• ë•Œë„ ëª¨ë‘ ì»¤ìŠ¤í…€í•˜ê²Œ êµ¬í˜„í•´ì•¼í•©ë‹ˆë‹¤.
    ë˜..... ê°€ë³€ì ì¸ ë†’ì´ë¥¼ ìœ„í•´ì„œë„ ë³„ë„ ì‘ì—…ì„ ë” ê±°ì³ì•¼í•©ë‹ˆë‹¤.

    ì¦‰ ì •ë¦¬í•´ë³´ë©´ SwiftUIì˜ ê¸°ë³¸ TextEditorë¡œ êµ¬í˜„ì„ í•  ìˆœ ìˆë‹¤!
    í•˜ì§€ë§Œ ê³µìˆ˜ê°€ ë§ì´ ë“¤ê³  ë·° ì½”ë“œê°€ ì˜¤íˆë ¤ ë” ë³µì¡í•´ì§ˆ ìˆ˜ ìˆë‹¤ğŸ¥²

    ê·¸ë˜ì„œ ì´ê±¸ í•´ê²°í•´ë³´ê³ ì ìš°ë¦¬ê°€ ìµìˆ™í•œ UIKitì˜ UITextViewë¥¼ ëŒì–´ë“¤ì—¬ì™€ ì‘ì—… í•´ë³´ê² ìŠµë‹ˆë‹¤.

    #### UITextView in SwiftUI

    ì ì œê°€ í•„ìš”í•œ êµ¬í˜„ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.
    1. í…ìŠ¤íŠ¸ ë¼ì¸ ìˆ˜ì— ë”°ë¼ ê°€ë³€ì ì¸ í…ìŠ¤íŠ¸ ì¸í’‹ì°½ ë†’ì´ ì¡°ì ˆ
    2. í”Œë ˆì´ìŠ¤í™€ë” êµ¬í˜„
    3. í™”ë©´ ì§„ì… ì‹œ ìë™ìœ¼ë¡œ í‚¤ë³´ë“œ ë…¸ì¶œ ë° í…ìŠ¤íŠ¸ í•„ë“œ ì¸í’‹ ì˜ì—­ì´ í•´ë‹¹ í‚¤ë³´ë“œ ìœ„ì— ìœ„ì¹˜í•˜ê¸°
    4. ê¸€ì ìˆ˜ ì œí•œ
    5. ê·¸ ì™¸ ë””ìì¸ì  ìš”ì†Œ ì»¤ìŠ¤í…€í•˜ê²Œ êµ¬í˜„

    ì´ê±° í•´ë³´ë ¤í•©ë‹ˆë‹¤!
    ê·¸ëŸ¼ í•´ë‹¹ ì»¤ìŠ¤í…€ TextView ì½”ë“œë¶€í„° ë³´ì‹œì£ !
    ```swift
    import SwiftUI

    public struct CustomTextView: UIViewRepresentable {
      @Binding var text: String
      @Binding var height: CGFloat
      var maxHeight: CGFloat
      var textFont: UIFont
      var textColor: UIColor = .black
      var textLimit: Int = 10
      var cornerRadius: CGFloat? = nil
      var borderWidth: CGFloat? = nil
      var borderColor: CGColor? = nil
      var isScrollEnabled: Bool = true
      var isEditable: Bool = true
      var isUserInteractionEnabled: Bool = true
      var lineFragmentPadding: CGFloat = 0
      var textContainerInset: UIEdgeInsets = .init(top: 10, left: 10, bottom: 10, right: 10)
      var placeholder: String? = nil
      var placeholderColor: UIColor = .gray

      public func makeUIView(context: Context) -> UITextView {
        let textView = UITextView()

        if let cornerRadius = cornerRadius {
          textView.layer.cornerRadius = cornerRadius
          textView.layer.masksToBounds = true
        }
        if let borderWidth = borderWidth {
          textView.layer.borderWidth = borderWidth
        }
        if let borderColor = borderColor {
          textView.layer.borderColor = borderColor
        }
        if let placeholder = placeholder {
          textView.text = placeholder
          textView.textColor = placeholderColor
        } else {
          textView.textColor = textColor
        }

        textView.font = textFont
        textView.isScrollEnabled = isScrollEnabled
        textView.isEditable = isEditable
        textView.isUserInteractionEnabled = isUserInteractionEnabled
        textView.textContainer.lineFragmentPadding = lineFragmentPadding
        textView.textContainerInset = textContainerInset
        textView.delegate = context.coordinator
        textView.becomeFirstResponder()

        return textView
      }

      public func updateUIView(_ uiView: UITextView, context: Context) {
        updateHeight(uiView)
      }

      public func makeCoordinator() -> Coordinator {
        return Coordinator(parent: self)
      }

      private func updateHeight(_ uiView: UITextView) {
        let size = uiView.sizeThatFits(CGSize(width: uiView.frame.width, height: .infinity))
        DispatchQueue.main.async {
          if size.height <= maxHeight {
            height = size.height
          }
        }
      }

      public class Coordinator: NSObject, UITextViewDelegate {
        var parent: CustomTextView

        init(parent: CustomTextView) {
          self.parent = parent
        }

        public func textViewDidChange(_ textView: UITextView) {
          parent.text = textView.text

          if textView.text.isEmpty {
            textView.textColor = parent.placeholderColor
          } else {
            textView.textColor = parent.textColor
          }

          if textView.text.count > parent.textLimit {
            textView.text.removeLast()
          }

          parent.updateHeight(textView)
        }

        public func textViewDidBeginEditing(_ textView: UITextView) {
          if textView.text == parent.placeholder {
            textView.text = ""
          }
        }

        public func textViewDidEndEditing(_ textView: UITextView) {
          if textView.text.isEmpty {
            textView.text = parent.placeholder
          }
        }
      }
    }
    ```
    ìœ¼ì•… ì¢€ ê¸¸ê¸´í•œë°... ì»¤ìŠ¤í…€í•œê±°ë‹ˆê¹Œâ­ï¸
    ì¼ë‹¨ UIViewRepresentableë¡œ UIKit ì„¸ìƒì— ìˆëŠ” UITextViewë¥¼ ê°€ì ¸ì™€ì¤ë‹ˆë‹¤.
    ê° íŒŒë¼ë¯¸í„°ë¡œ ë“¤ì–´ê°ˆ ì¸ìë“¤ì€ ìƒëµí•˜ê³ ~
    updateHeight ë©”ì„œë“œë¥¼ ë³´ì‹œì£ !
    í•´ë‹¹ ë©”ì„œë“œë¥¼ ë³´ì‹œë©´ í˜„ì¬ UIViewì˜ ì‚¬ì´ì¦ˆë¥¼ íŒë‹¨í•˜ë©° maxHeightê¹Œì§€ë§Œ ë¦¬ë°‹ì„ ê±¸ë©° ê°€ë³€ ë³€í™˜ì„ í•´ì¤ë‹ˆë‹¤.
    ê·¸ë¦¬ê³  updateUIViewì—ì„œ í•´ë‹¹ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•´ ê³„ì† íŒë‹¨í•˜ì£ .
    ê·¸ ë‹¤ìŒ UITextViewDelegateì˜ ê¸°ëŠ¥ì„ ê°€ì ¸ì™€ í•„ìš”í•œ êµ¬í˜„ì„ í•´ì¤ë‹ˆë‹¤.
    ì—¬ê¸°ì„œ í•„ìš”í•œ êµ¬í˜„ì€ í”Œë ˆì´ìŠ¤í™€ë” êµ¬ë¶„ ë° ê¸€ì ìˆ˜ ì…ë ¥ ì œí•œ ë“±ê³¼ ê°™ì€ ë‹¤ì–‘í•œ ê¸°ëŠ¥ë“¤ì„ ë„£ì–´ì¤„ ìˆ˜ ìˆì–´ìš”.

    ì ë‚˜ë¨¸ì§€ëŠ” ê±°ì˜ ë””ìì¸ì ì¸ ì»¤ìŠ¤í…€ì´ë‹ˆ íŒ¨ìŠ¤í•˜ê³  ì‹¤ì œ í•´ë‹¹ ë·°ë¥¼ ì–¹ì–´ë³¼ê¹Œìš”?
    ```swift
    import SwiftUI

    struct ContentView: View {
      var body: some View {
        VStack(alignment: .leading, spacing: 10) {
          Spacer()
            .frame(height: 100)

          Button(
            action: {
              UIApplication.shared.sendAction(#selector(UIResponder.resignFirstResponder), to: nil, from: nil, for: nil)
            },
            label: {
              Text("Hide Keyboard")
            }
          )

          Spacer()

          TextWritingView()
            .background(.gray)
        }
      }
    }

    private struct TextWritingView: View {
      @State private var height: CGFloat = 30
      @State var text: String = ""
      private var registerButtonDisabled: Bool {
        text.isEmpty
      }
      private var registerButtonTextColor: Color {
        text.isEmpty ? .red : .green
      }

      var body: some View {
        HStack(alignment: .bottom, spacing: 10) {
          // ëŒ“ê¸€ ì…ë ¥ì°½
          CustomTextView(
            text: $text,
            height: $height,
            maxHeight: 200,
            textFont: .boldSystemFont(ofSize: 14),
            cornerRadius: 5,
            borderWidth: 1,
            borderColor: CGColor.init(red: 255, green: 255, blue: 255, alpha: 1),
            placeholder: "ëŒ“ê¸€ì„ ì…ë ¥í•´ ì£¼ì„¸ìš”"
          )
          .frame(minHeight: height, maxHeight: .infinity)

          // ë“±ë¡ ë²„íŠ¼
          Button(
            action: {
              UIApplication.shared.sendAction(#selector(UIResponder.resignFirstResponder), to: nil, from: nil, for: nil)
            },
            label: {
              Text("ë“±ë¡")
                .foregroundColor(registerButtonTextColor)
            }
          )
          .disabled(registerButtonDisabled)
          .padding(.bottom, 5)
        }
        .padding(.all, 10)
        .frame(height: 50)
        .frame(minHeight: height + 20)
      }
    }
    ```
    ë¨¼ì € ë´ì•¼í• ê±´ TextWritingViewì…ë‹ˆë‹¤.
    ì»¤ìŠ¤í…€í•œ TextViewì™€ heightë¥¼ ê³µìœ í•˜ë„ë¡ @State ë³€ìˆ˜ë¥¼ ì´ˆê¸° ë†’ì´ë¥¼ ì£¼ì–´ ì§€ì •í•˜ê³  textë„ ë§ˆì°¬ê°€ì§€ë¡œ ì§€ì •í•©ë‹ˆë‹¤.
    ê·¸ í›„ frame ì‘ì—…ë§Œ ì˜ ì»¨íŠ¸ë¡¤ í•´ì£¼ë©´ ë©ë‹ˆë‹¤.
    TextFieldì˜ ìµœì†Œ ë†’ì´ëŠ” heightì´ê³  ìµœëŒ€ ë†’ì´ì— ëŒ€í•´ì„œëŠ” ì»¤ìŠ¤í…€í•˜ê²Œ êµ¬í˜„í•œ í…ìŠ¤íŠ¸ë·° ë‚´ë¶€ì—ì„œ ì»¨íŠ¸ë¡¤ ë©ë‹ˆë‹¤.
    ë“±ë¡ ë²„íŠ¼ì´ë‚˜ íŠ¹ì •í•œ onTapGestureë¥¼ í–ˆì„ë•Œ í‚¤ë³´ë“œë¥¼ ìˆ¨ê²¨ì¤„ ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•´ì¤ë‹ˆë‹¤.

    ì´ëŸ¬ë©´ ì‚¬ì‹¤ ëì´ë¼ í¬ê²Œ ì„¤ëª…ë³´ë‹¤ ì½”ë“œ ë³´ê³  ì´í•´í•˜ëŠ”ê²Œ ë¹ ë¥¼ê²ƒ ê°™ê¸´ í•˜ë„¤ìš”ğŸ¥²
    
    #### ë§ˆë¬´ë¦¬

    ê·¸ëƒ¥ ìƒí™œ ì† ë°œê²¬ ê°™ì€ ëŠë‚Œìœ¼ë¡œ ê°€ë³ê²Œ êµ¬í˜„í•´ë³´ë©´ì„œ ê³µìœ í•´ë´ìš”ğŸ™Œ

    #### [ì°¸ê³  ìë£Œ]
    https://green1229.tistory.com/330   
    ì œ ì•„ë˜ ê¹ƒí—™ ë ˆí¬ì— ìœ„ ì˜ˆì œ ì†ŒìŠ¤ì½”ë“œë¥¼ ì˜¬ë ¤ë†¨ìŠµë‹ˆë‹¤.
    https://github.com/GREENOVER/playground/tree/main/customTextView
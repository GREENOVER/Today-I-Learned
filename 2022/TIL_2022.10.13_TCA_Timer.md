## TIL (Today I Learned)

### 10ì›” 13ì¼ (ëª©)    

- #### [í•™ìŠµë‚´ìš©] 
    #### TCA - Timer

    #### Timer???      

    TimerëŠ” ê¸°ë³¸ì ìœ¼ë¡œ Combineê³¼ ê·¸ë¥¼ ìƒì†ë°›ì•„ ë§Œë“¤ì–´ì§„ CombineSchedulersë¥¼ ì„í¬íŠ¸ í•©ë‹ˆë‹¤!   
    ```swift
    import Combine
    import CombineSchedulers
    ```
    ìŠ¤ì¼€ì¥´ë§ê³¼ ê´€ë ¨ì´ ìˆë‹¤ëŠ”ê²Œ í™• ëŠê»´ì§€ì£ .
    TimerëŠ” ì§€ì •ëœ ìŠ¤ì¼€ì¥´ëŸ¬ì˜ í˜„ì¬ ì‹œê°„ì„ ì§€ì •ëœ ìŠ¤ì¼€ì¥´ëŸ¬ì—ì„œ ë°˜ë³µì ìœ¼ë¡œ ë°©ì¶œí•˜ëŠ” íš¨ê³¼ ì¦‰ Effectë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤.
    ë¬¼ë¡  Foundationì˜ Timer.publish(every:tolerance:on:in:options:) APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ TCAì—ì„œëŠ” Timerë¥¼ ìƒì„±í•˜ëŠ”ê²ƒì„ ê¶Œì¥í•˜ì§€ ì•Šì•„ìš”.
    ê·¸ ì´ìœ ëŠ” í•´ë‹¹ APIëŠ” ì‹¤í–‰ ë£¨í”„ì— íƒ€ì´ë¨¸ë¥¼ ë§Œë“¤ê¸°ì— í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ë•Œ ëª…ì‹œì ì¼ í•„ìš”ê°€ ìˆìŠµë‹ˆë‹¤.
    ë˜í•œ ê¸°ëŠ¥ì—ì„œ íš¨ê³¼ê°€ ì–´ë–»ê²Œ ê±°ì³ê°€ëŠ”ì§€ ë³´ê¸° ìœ„í•´ í•´ë‹¹ íƒ€ì´ë¨¸ê°€ ëë‚ ë•Œê¹Œì§€ ê¸°ë‹¤ë ¤ì•¼ í•©ë‹ˆë‹¤.
    TCAì—ì„œëŠ” ì‹œê°„ ê¸°ë°˜ ì´í™íŠ¸ë¥¼ í…ŒìŠ¤íŠ¸ í•©ë‹ˆë‹¤.
    ê·¸ë ‡ê¸°ì— TestSchedulerëŠ” ì‹œê°„ì„ ëª…ì‹œì  ë˜ëŠ” ì¦‰ì‹œ ì•ë‹¹ê¸¸ ìˆ˜ ìˆê¸°ì— íš¨ê³¼ë¥¼ ì–´ë–»ê²Œ ë°©ì¶œí•˜ëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ê·¸ëŸ¬ë‚˜ Timer.publishëŠ” êµ¬ì²´ì ì¸ ëŸ°ë£¨í”„ë¥¼ ì‚¬ìš©í•˜ê¸°ì— í…ŒìŠ¤íŠ¸ ì¤‘ TestSchedulerë¥¼ ëŒ€ì²´í•  ìˆ˜ ì—†ì–´ìš”.
    ì´ëŸ¬í•œ ì´ìœ ë“¤ë¡œ PointFreeì—ì„œëŠ” Effect.timerë¼ëŠ”ê²ƒì„ ë§Œë“¤ì–´ ì œê³µí•˜ê³  ìˆìŠµë‹ˆë‹¤.
    ì´ëŠ” DispatchQueue, RunLoopì—ì„œ ëª¨ë‘ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.
    TimerëŠ” ìœ„ì—ì„œ ì ê¹ë„ ë§í–ˆë‹¤ ì‹œí”¼ Effectì˜ extensionì…ë‹ˆë‹¤.
    ```swift
    extension Effect where Failure == Never
    ```

    ê·¸ëŸ¼ Timerê°€ ë¬´ì—‡ì¸ì§€ ê°œë…ì ìœ¼ë¡œ í™•ì¸í–ˆê³  ì–´ë”” ì†Œì†ì¸ì§€ ë°í˜”ìœ¼ë‹ˆ ì •ì˜ë¥¼ ë³´ê² ìŠµë‹ˆë‹¤!

    #### Timer ì •ì˜
    ```swift
    extension Effect where Failure == Never {
      public static func timer<S: Scheduler>(
        id: AnyHashable,
        every interval: S.SchedulerTimeType.Stride,
        tolerance: S.SchedulerTimeType.Stride? = nil,
        on scheduler: S,
        options: S.SchedulerOptions? = nil
      ) -> Self where S.SchedulerTimeType == Output {

        Publishers.Timer(every: interval, tolerance: tolerance, scheduler: scheduler, options: options)
          .autoconnect()
          .setFailureType(to: Failure.self)
          .eraseToEffect()
          .cancellable(id: id, cancelInFlight: true)
      }

        public static func timer<S: Scheduler>(
        id: Any.Type,
        every interval: S.SchedulerTimeType.Stride,
        tolerance: S.SchedulerTimeType.Stride? = nil,
        on scheduler: S,
        options: S.SchedulerOptions? = nil
      ) -> Self where S.SchedulerTimeType == Output {
        self.timer(
          id: ObjectIdentifier(id),
          every: interval,
          tolerance: tolerance,
          on: scheduler,
          options: options
        )
      }
    }
    ```
    ë³´ì‹œë©´ ë‘ static ë©”ì„œë“œê°€ ìˆìŠµë‹ˆë‹¤.
    ìœ„ê°€ ê¸°ë³¸ êµ¬í˜„ ì•„ë˜ëŠ” ìœ„ì˜ êµ¬í˜„ì„ selfë¡œ í˜¸ì¶œí•©ë‹ˆë‹¤.
    ì°¨ì´ëŠ” id íŒŒë¼ë¯¸í„°ì— ìˆì–´ìš”.
    idëŠ” Hashableí•œ ê°ì²´ë¥¼ ë°›ìŠµë‹ˆë‹¤.
    ì•„ë˜ëŠ” Any ì¦‰ ì•„ë¬´ íƒ€ì…ì´ë‚˜ ë°›ì„ ìˆ˜ ìˆì§€ë§Œ Hashablí•´ì•¼ í•˜ê¸°ì— ObjectIdentifierì— ê°ì‹¸ì„œ self.timerë¥¼ í˜¸ì¶œí•©ë‹ˆë‹¤.
    ì¦‰ ë­ êµ¬í˜„ì€ ê°™ì•„ìš”!
    ë‚´ë¶€ì—ì„œëŠ” Combineì—ì„œ ìµìˆ™í•œ Publisherì˜ Timerë¥¼ ì‚¬ìš©í•´ì£¼ê³  Effect íƒ€ì…ìœ¼ë¡œ ë³€í™˜í•´ì£¼ëŠ”ê²Œ ë‹¤ë„¤ìš”.
    intervalë¡œ ì‹œê°„ íƒ€ì´ë¨¸ ê°„ê²©ì„ ì£¼ê³  on ë ˆì´ë¸”ì´ ë‹¬ë¦° schedulerëŠ” ì–´ë””ì„œ ìŠ¤ì¼€ì¥´ë§ì„ ëŒì§€ ë„£ì–´ì¤ë‹ˆë‹¤.
    optionsìœ¼ë¡œ SchedulerOptionsì„ ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    ì •ì˜ëŠ” ì´ì •ë„ë©´ ì¶©ë¶„í• ê²ƒ ê°™ê³  ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ ë³´ì‹œì£ ğŸ•ºğŸ»

    #### Timer êµ¬í˜„

    TimerëŠ” Reducerì—ì„œ Effect ë°©ì¶œì— ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    í•´ë‹¹ Effectê°€ ë°©ì¶œë˜ëŠ” ì‹œì ì˜ íƒ€ì´ë¨¸ë¥¼ ê±¸ì–´ì¤„ ìˆ˜ ìˆëŠ”ê²ƒì´ì£ .
    ì•„ë˜ì™€ ê°™ì´ ë³´í†µ ì‚¬ìš©ë©ë‹ˆë‹¤.
    ```swift
    struct AppState {
      var count = 0
    }

    enum AppAction {
      case startButtonTapped, stopButtonTapped, timerTicked
    }

    struct AppEnvironment {
      var mainQueue: AnySchedulerOf<DispatchQueue>
    }

    let appReducer = Reducer<AppState, AppAction, AppEnvironment> { state, action, env in
      struct TimerId: Hashable {}

      switch action {
      case .startButtonTapped:
        return Effect.timer(id: TimerId(), every: 1, on: env.mainQueue)
          .map { _ in .timerTicked }

      case .stopButtonTapped:
        return .cancel(id: TimerId())

      case .timerTicked:
        state.count += 1
        return .none
      }
    }
    ```
    ë³´ì‹œë©´ startButtonTapped ì•¡ì…˜ì´ ë“¤ì–´ì˜¤ë©´ ReducerëŠ” timerTicked ì•¡ì…˜ì„ ë°©ì¶œí•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
    ê·¸ëŸ°ë° ì´ timerTicked ì•¡ì…˜ ë°©ì¶œì˜ ì‹œê°„ì„ 1ì´ˆ ì§€ì—°í•˜ê³  ì§€ì†ì ìœ¼ë¡œ ë°©ì¶œí•˜ê¸° ìœ„í•´ ìœ„ì™€ ê°™ì´ Effect.timerë¥¼ ì´ìš©í•´ ì‚¬ìš©í•©ë‹ˆë‹¤.
    ê·¸ í›„ map ì˜¤í¼ë ˆì´í„°ë¥¼ ì´ìš©í•´ timerTicked Actionì„ ë°©ì¶œí•´ì£¼ë©´ ëì…ë‹ˆë‹¤.
    ë³´ì‹œë©´ TimerIdë¼ëŠ” Hashableí•œ ê°ì²´ë¥¼ ë§Œë“¤ì–´ ì‚¬ìš©í•˜ê³  ìˆìŠµë‹ˆë‹¤.
    ê·¸ë ‡ê¸°ì— í•´ë‹¹ íƒ€ì´ë¨¸ë¥¼ ì¢…ë£Œì‹œí‚¤ê¸° ìœ„í•´ stopButtonTapped ì•¡ì…˜ì—ì„œ í•´ë‹¹ ê°ì²´ë¥¼ ì´ìš©í•´ ì·¨ì†Œì‹œì¼œì£¼ê³  ìˆìŠµë‹ˆë‹¤.
    ê·¸ëŸ¼ í•´ë‹¹ ê¸°ëŠ¥ì´ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ë³´ì‹œì£ !

    startë¥¼ ëˆ„ë¥´ë©´ 1ì´ˆ ë’¤ 1ì´ˆ ê°„ê²©ìœ¼ë¡œ ê³„ì† ì•¡ì…˜ì´ ë°©ì¶œë˜ì–´ ìˆ«ìê°€ ì˜¬ë¼ê°‘ë‹ˆë‹¤.
    ë„ì¤‘ stopì„ ëˆ„ë¥´ë©´ í•´ì œë˜ì–´ ë©ˆì¶”ì£ .
    ì´ë ‡ê²Œ íƒ€ì´ë¨¸ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ë¬¸ì ì¸ì¦ íƒ€ì´ë¨¸ì—ë„ ë§ì´ ì‚¬ìš©ë  ìˆ˜ ìˆê² ì£ ?

    #### ë§ˆë¬´ë¦¬

    ì´ë ‡ê²Œ Timerë¥¼ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤!
    ë‹¤ë“¤ íšŒì›ê°€ì…ì„ ìœ„í•´ ë¬¸ì ì¸ì¦ì€ ë§ì´ í•˜ê¸°ì— ì‹¤ì‹œê°„ìœ¼ë¡œ íƒ€ì´ë¨¸ë¥¼ ê±¸ì–´ ì²´í¬í•˜ëŠ” ë¡œì§ë“¤ì—ì„œ íš¨ê³¼ ë°©ì¶œì„ ìœ„í•´ ì‚¬ìš©í•˜ë©´ ì¢‹ì•„ë³´ì—¬ìš”!

    #### [ì°¸ê³ ìë£Œ]
    https://green1229.tistory.com/289    
    https://github.com/pointfreeco/swift-composable-architecture/blob/main/Sources/ComposableArchitecture/Effects/Publisher/Timer.swift   

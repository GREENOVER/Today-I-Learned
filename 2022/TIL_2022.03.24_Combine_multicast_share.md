## TIL (Today I Learned)

### 3ì›” 24ì¼ (ëª©)   

- #### [í•™ìŠµë‚´ìš©] 
  ### Combine - multicast / share   
  
  #### multicast   
  ê³µì‹ë¬¸ì„œë¥¼ ë³´ë©´ í´ë¡œì €ë¥¼ ì ìš©í•´ êµ¬ë…ìì—ê²Œ ìš”ì†Œë¥¼ ì „ë‹¬í•˜ëŠ” subjectë¥¼ ë§Œë“¤ì–´ì¤€ë‹¤ê³ í•´ìš”.   
  ì—­ì‹œ ê³µì‹ë¬¸ì„œì˜ ì •ì˜ëŠ” ì–´ë ¤ì›Œ...!ğŸ¤¯      
  ìš°ì„  ê·¸ëŸ¬ë ¤ë‹ˆ~ í•˜ê³  ì •ì˜ëœ ì½”ë“œë¥¼ ë³´ì‹œì£ !!     
  ```swift
  func multicast<S>(_ createSubject: @escaping () -> S) -> Publishers.Multicast<Self, S> where S : Subject, Self.Failure == S.Failure, Self.Output == S.Output
  ```
  ìš”ë ‡ê²Œ ë˜ì–´ìˆì–´ìš”.    
  ì•„ì§ê¹Œì§€ ê°ì´ ì•ˆì˜¤ì‹œì£ ?    
  ê·¸ëŸ¼ ê¸°ì¡´ì—ëŠ” ì–´ë–»ê²Œ ì‚¬ìš©ë˜ì—ˆëŠ”ì§€ ë˜ multicastê°€ ì–´ë–»ê²Œ ì‚¬ìš©ë ì§€ ë³´ì‹œì£ !    

  #### [multicast ë¯¸ì‚¬ìš©]    
  ```swift
  let pub = ["First", "Second", "Third"].publisher
      .map( { return ($0, Int.random(in: 0...100)) } )
      .print("Random")
  
  cancellable1 = pub
     .sink { print ("Stream 1 received: \($0)")}
  cancellable2 = pub
     .sink { print ("Stream 2 received: \($0)")}
  
  // Random: receive value: (("First", 9))
  // Stream 1 received: ("First", 9)
  // Random: receive value: (("Second", 46))
  // Stream 1 received: ("Second", 46)
  // Random: receive value: (("Third", 26))
  // Stream 1 received: ("Third", 26)
  // Random: receive value: (("First", 9))
  // Stream 2 received: ("First", 9)
  // Random: receive value: (("Second", 46))
  // Stream 2 received: ("Second", 46)
  // Random: receive value: (("Third", 26))
  // Stream 2 received: ("Third", 26)
  ```
  ê¸°ì¡´ì—ëŠ” ì´ë ‡ê²Œ ê° pubì—ì„œì˜ ë°œí–‰ì´ 2ë²ˆ ì´ë£¨ì–´ì¡Œì–´ìš”.   
  ì§€ê¸ˆì´ì•¼ í¬ê²Œ ë¬¸ì œê°€ ì—†ì§€ë§Œ ë§Œì•½ í†µì‹ ì´ë‚˜ ë°©ëŒ€í•œ ì„œë¹„ìŠ¤ì— ëŒ€í•´ ì—¬ëŸ¬ êµ¬ë…ìê°€ êµ¬ë…ì„ í•˜ê³  ìˆìœ¼ë©´ ë‚­ë¹„ê² ì£ ?    
  ê°™ì€ê±¸ ì—¬ëŸ¬ êµ¬ë…ìë•Œë¬¸ì— ì—¬ëŸ¬ë²ˆ ë°œí–‰í•˜ëŠ” í˜•íƒœì´ë‹ˆê¹Œìš”!   
  ê·¸ë˜ì„œ multicastë¥¼ ì‚¬ìš©í•˜ë©´ ì´ë¡­ìŠµë‹ˆë‹¤ğŸ™Œ    

  multicastë„ ì´ì œ ì‰½ê²Œ ì½”ë“œë¡œ ë³´ë©´ì„œ ê°ì„ ì°¾ì•„ë³´ì‹œì£ !   
  (ì½”ë“œëŠ” ê³µì‹ë¬¸ì„œì—ì„œ ì˜ˆì œ ì½”ë“œë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤)   

  #### [multicast ì‚¬ìš©]   
  ```swift
  let pub = ["First", "Second", "Third"].publisher
      .map( { return ($0, Int.random(in: 0...100)) } )
      .print("Random")
      .multicast { PassthroughSubject<(String, Int), Never>() }
  
  cancellable1 = pub
     .sink { print ("Stream 1 received: \($0)")}
  cancellable2 = pub
     .sink { print ("Stream 2 received: \($0)")}
  
  pub.connect()
  
  // Random: receive value: (("First", 9))
  // Stream 2 received: ("First", 9)
  // Stream 1 received: ("First", 9)
  // Random: receive value: (("Second", 46))
  // Stream 2 received: ("Second", 46)
  // Stream 1 received: ("Second", 46)
  // Random: receive value: (("Third", 26))
  // Stream 2 received: ("Third", 26)
  // Stream 1 received: ("Third", 26)
  ```
  ì§œë€ ì¼ë‹¨ ê²°ê³¼ë¥¼ ë³´ë©´ í•œë²ˆ ë°œí–‰ìœ¼ë¡œ ì—¬ëŸ¬ êµ¬ë…ìì—ì„œ ë°›ì•„ì¤ë‹ˆë‹¤!   
  í¸ì•ˆ....   
  ë‹¬ë¼ì§„ ë¶€ë¶„ì„ ë³´ë©´ publisherì—ì„œ multicast í´ë¡œì € ë¸”ëŸ­ì„ ë„£ì–´ì¤˜ìš”.   
  ê·¸ë¦¬ê³  ë§ˆì§€ë§‰ì— connect()ë¥¼ í•´ì¤˜ì•¼ ì •ìƒì ìœ¼ë¡œ ì‚¬ìš©ì´ ë©ë‹ˆë‹¤!    
  connect ê´€ë ¨í•´ì„œëŠ” ì™œ ê·¸ëŸ°ì§€ ìƒê°í•´ë³´ë©´ multicastë¥¼ í•´ì£¼ë©´ Publishers.Multicastë¡œ íƒ€ì…ì´ ë³€í™˜ë˜ìš”.   
  ì´ Multicast íƒ€ì…ì„ ê¹Œë³´ë©´ ConnectablePublisherë¥¼ ì±„íƒí•˜ê³  ìˆìŠµë‹ˆë‹¤.   
  ì € ì¹œêµ¬ì˜ íŠ¹ì„±ìƒ connect()ë¥¼ í˜¸ì¶œí•´ì•¼ ìš”ì†Œë“¤ì„ ë°©ì¶œí•©ë‹ˆë‹¤.   
  ì´ ë¶€ë¶„ì€ ë‹¤ìŒ í¬ìŠ¤íŒ…ì—ì„œ ConnectablePublisherì´ ë­”ì§€ ì¡°ê¸ˆ ë” ìì„¸íˆ ì•Œì•„ë³´ê¸°ë¡œ í•˜ì£ !ğŸ™‹ğŸ»   

  ê·¸ëŸ¬ë©´ ì´ì œ shareê°€ ë‚¨ì•˜ë„¤ìš”?   
  ë­˜ê¹Œìš” ì´ë…€ì„ì€ ë„ëŒ€ì²´ğŸ™ƒ   
  
  #### share    
  ê³µì‹ë¬¸ì„œì˜ ì„¤ëª…ë¶€í„° ë³´ì£ !   
  ì—…ìŠ¤íŠ¸ë¦¼ ê²Œì‹œìì˜ ì¶œë ¥ì„ ì—¬ëŸ¬ êµ¬ë…ìì™€ ê³µìœ í•˜ë„ë¡ í•´ì£¼ëŠ” ë©”ì„œë“œë¼ê³  í•©ë‹ˆë‹¤.   
  multicastì™€ ìœ ì‚¬í•´ë³´ì´ì£ ? ì´ë ‡ê²Œ ë¬¶ì–´ì„œ í¬ìŠ¤íŒ…í•˜ëŠ”ê²ƒë„ ì´ìœ ê°€ ë ê²ƒ ê°™ë„¤ìš”ğŸ™Œ   
  ```swift
  func share() -> Publishers.Share<Self>
  ```
  ì„ ì–¸ì€ ìš”ë ‡ìŠµë‹ˆë‹¤.   
  ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë°˜í™˜ëœ PublisherëŠ” ì—¬ëŸ¬ Subscriberë“¤ì„ ì§€ì›í•˜ê³  ëª¨ë‘ ë³€ê²½ë˜ì§€ ì•Šì€ ìš”ì†Œë“¤ê³¼ ì™„ë£Œ ì—¬ë¶€ ìƒíƒœë¥¼ ë°›ìŠµë‹ˆë‹¤.   
  ìš°ë¦¬ ìœ„ì—ì„œ multicastí• ë•Œ ConnectablePublisherë¥¼ ë”°ë¥´ëŠ” Multicast íƒ€ì…ì´ ë¨ìœ¼ë¡œ connect()ë¥¼ ê¼­ í˜¸ì¶œí•´ì¤˜ì•¼ ë°œí–‰ëœë‹¤ê³  í–ˆì£ ?    
  ì´ ì¹œêµ¬ëŠ” ê·¸ëŸ°ê±° ì—†ìŠµë‹ˆë‹¤.   
  ì™œëƒë©´, ë‚´ë¶€ì ìœ¼ë¡œ autoconnect()ë¥¼ í˜¸ì¶œí•˜ê³  ìˆê¸° ë•Œë¬¸ì´ì£ !   
  ì¦‰ connect()ë¥¼ í˜¸ì¶œí•˜ì§€ ì•Šì•„ë„ Subscriberì—ì„œ êµ¬ë…í•´ì£¼ëŠ” ìˆœê°„ë¶€í„° ë°›ê³  ìˆê²Œ ë©ë‹ˆë‹¤.   
  ëŒ€ì‹  ì´ê²ƒë•Œë¬¸ì— ì¤‘ìš”í•œê²Œ ìˆìŠµë‹ˆë‹¤.   
  ì—¬ëŸ¬ êµ¬ë…ìê°€ sinkí•´ì£¼ëŠ” ì‹œì ì´ ë‹¤ë¥¼í…ë° ì²« êµ¬ë…ìê°€ sinkí•´ì¤„ë•Œ ë°”ë¡œ ë°©ì¶œë˜ê²Œ ëœë‹¤ë©´ ì•ˆë˜ê² ì£ ?   
  ê·¸ë˜ì„œ delayë¥¼ ê±¸ì–´ì¤˜ì•¼í•©ë‹ˆë‹¤.   
  "Talk is cheap. Show me the code."   

  ë„¤.. ì´ ë¬¸êµ¬ ì°¸ ë§˜ì— ë“œë„¤ìš”ğŸ™ƒ   
  (ë™ì¼í•˜ê²Œ ê³µì‹ë¬¸ì„œì˜ ì˜ˆì œ ì½”ë“œë¥¼ ê°€ì ¸ì™”ìŠµë‹ˆë‹¤.)   
  ```swift
  let pub = (1...3).publisher
      .delay(for: 1, scheduler: DispatchQueue.main)
      .map( { _ in return Int.random(in: 0...100) } )
      .print("Random")
      .share()
  
  cancellable1 = pub
      .sink { print ("Stream 1 received: \($0)")}
  cancellable2 = pub
      .sink { print ("Stream 2 received: \($0)")}
  
  // Random: receive value: (20)
  // Stream 1 received: 20
  // Stream 2 received: 20
  // Random: receive value: (85)
  // Stream 1 received: 85
  // Stream 2 received: 85
  // Random: receive value: (98)
  // Stream 1 received: 98
  // Stream 2 received: 98
  ```
  publisherë¥¼ ìƒì„±í• ë•Œ delayë¥¼ ê±¸ì–´ì£¼ëŠ” ì´ìœ ëŠ” ìœ„ì— ì„¤ëª…í–ˆìŠµë‹ˆë‹¤.    
  ì´ì–´ share()ë§Œ í˜¸ì¶œí•˜ì—¬ ë¶™ì—¬ì¤˜ ì´ Publisherì˜ íƒ€ì…ì„ Publiser.Shareë¡œ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.   
  ê·¸ë¦¬ê³  ì—¬ëŸ¬ êµ¬ë…ìì—ì„œ ì´ publisherë¥¼ êµ¬ë…í•˜ë©´ í•˜ë‚˜ì˜ ë°œí–‰ì—ì„œ ìœ„ì—ì„œ í–ˆë˜ multicastì˜ ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ ì§„í–‰ë©ë‹ˆë‹¤!   
  ë‘˜ì´ ì°¸ ë¹„ìŠ·í•˜ë„¤ìš”ğŸ™Œ   
  
  #### ë§ˆë¬´ë¦¬    
  ì´ë ‡ê²Œ multicastì™€ shareì— ëŒ€í•´ ì•Œì•„ë³´ì•˜ìŠµë‹ˆë‹¤!    
  ë‘˜ë‹¤ ë¹„ìŠ·í•œ ì“°ì„ì´ë¼ ë” ì‰¬ì› ë˜ ì´í•´íë¦„ì´ ë˜ì—ˆì–´ìš”ã…ã…   
  ì•„ì§ ê°ˆê¸¸ë©€ë‹¤ combine......ğŸƒğŸ»   
  
  #### [ì°¸ê³ ìë£Œ]    
  https://green1229.tistory.com/230   
  https://developer.apple.com/documentation/combine/publisher/multicast(_:)    
  https://developer.apple.com/documentation/combine/publisher/share()    

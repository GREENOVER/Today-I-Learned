## TIL (Today I Learned)

### 10ì›” 17ì¼ (ì›”)    

- #### [í•™ìŠµë‚´ìš©] 
    #### TCA - Debouncing

#### **Debounce?**

Debouncingì´ë¼ëŠ”ê±´ ìš°ì„  ë­˜ ëœ»í•˜ëŠ” ê±¸ê¹Œìš”??   

ì˜ˆì „ì— ì œê°€ **Rxë¥¼ ê³µë¶€í•˜ë©´ì„œ Debounceì™€ Throttleì„ í¬ìŠ¤íŒ…**í•œ ì ì´ ìˆìŠµë‹ˆë‹¤.

**[https://green1229.tistory.com/m/178ï»¿](https://green1229.tistory.com/m/178)**

[RxSwfit - Debounce & Throttleì•ˆë…•í•˜ì„¸ìš”. ê·¸ë¦°ì…ë‹ˆë‹¤ğŸŸ¢ ì´ë²ˆ í¬ìŠ¤íŒ…ì—ì„œëŠ” RxSwiftì—ì„œ ì‚¬ìš©ë˜ëŠ” debounceì™€ throttleì— ëŒ€í•´ í•™ìŠµí•´ë³´ê² ìŠµë‹ˆë‹¤ğŸ§‘ğŸ»â€ğŸ’» ìì„¸íˆ í•™ìŠµí•˜ê¸°ì „ ê°„ë‹¨í•˜ê²Œ debounceì™€ throttleì´ ì–´ë–¤ê±¸ í•´ì£¼ëŠ” ë©”ì„œë“œì¸green1229.tistory.com](https://green1229.tistory.com/m/178)

ìì„¸íˆ ë³´ì‹¤ ë¶„ë“¤ì€ ì´ í¬ìŠ¤íŒ…ì„ ì„ í–‰ìœ¼ë¡œ ì°¸ê³ í•˜ì…”ë„ ì¢‹ì„ê²ƒ ê°™ì•„ìš”!

ê°„ëµí•˜ê²Œ Debounceì— ëŒ€í•œ ìš”ì•½ì„ í•´ë³´ìë©´ **íƒ€ì´ë¨¸ë¥¼ ê±¸ì–´ì„œ íƒ€ì´ë¨¸ê°€ ì¢…ë£Œë˜ê¸° ì „ê¹Œì§€ ë¬´ìˆ˜íˆ ë§ì€ ì´ë²¤íŠ¸ê°€ ë°©ì¶œë˜ì–´ë„ ë¬´ì‹œë˜ê³ **

**íƒ€ì´ë¨¸ ì¢…ë£Œ í›„ ë“¤ì–´ì˜¨ ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œí•˜ë„ë¡ í•˜ëŠ” ë©”ì„œë“œ**ì…ë‹ˆë‹¤.

ì‚¬ì‹¤ìƒ ë¬´ìˆ˜íˆ ë§ì€ ì´ë²¤íŠ¸ ë°©ì¶œì„ ë§‰ì„ ìˆ˜ ìˆëŠ” ëª©ì ì´ ê°€ì¥ í´ ìˆ˜ ìˆê¸°ì— **ìë™ì™„ì„± í˜¹ì€ ì—°ê´€ê²€ìƒ‰ì–´ ê¸°ëŠ¥ì—ì„œ ìì£¼ í™œìš©**ë©ë‹ˆë‹¤.

ì´ìœ ëŠ” ë§ˆì§€ë§‰ ë“¤ì–´ì˜¨ ì´ë²¤íŠ¸ë§Œ ë°©ì¶œí•˜ì§€ ì•Šê³  ê³„ì† ì´ë²¤íŠ¸ë¥¼ ë°©ì¶œì‹œí‚¨ë‹¤ë©´ ê³¼ë¶€í•˜ê°€ ê±¸ë¦´ ìˆ˜ ìˆê¸° ë”± ì¢‹ì•„ì„œ ì¼ê±°ì—ìš”ğŸ¤ª



> ê·¸ëŸ¼ Debounceì— ëŒ€í•´ ì•„ ì´ëŸ° ê°œë…ì´êµ¬ë‚˜ ì•Œì•„ë´¤ìœ¼ë‹ˆ TCAì—ì„œëŠ” ì–´ë–»ê²Œ ì†Œê°œë˜ê³  ì‚¬ìš©ë˜ëŠ”ì§€ ì•Œì•„ë³´ì‹œì£ !

<!---->

#### **TCAì—ì„œì˜ Debouncing ì •ì˜**

TCAì—ì„œë„ ìœ„ì˜ ë™ì¼ ì—­í• ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.

Effect íƒ€ì…ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë©”ì„œë“œì£ .

ì¦‰, Effectë¥¼ Debounceí•  ìˆ˜ ìˆëŠ” Effect íƒ€ì…ìœ¼ë¡œ ë³€ê²½í•´ì¤ë‹ˆë‹¤.

í•´ë‹¹ ë©”ì„œë“œ ì‚¬ìš©ì„ ìœ„í•´ì„œëŠ” Hashableí•œ id ì‹ë³„ìë¥¼ ì´ìš©í•´ì¤ë‹ˆë‹¤.

ì•„ë˜ TCAì—ì„œì˜ debounce ë©”ì„œë“œ ì •ì˜ êµ¬í˜„ì„ ë³¼ê¹Œìš”?

```
extension Effect {
  public func debounce<S: Scheduler>(
    id: AnyHashable,
    for dueTime: S.SchedulerTimeType.Stride,
    scheduler: S,
    options: S.SchedulerOptions? = nil
  ) -> Self {
    switch self.operation {
    case .none:
      return .none
    case .publisher, .run:
      return Self(
        operation: .publisher(
          Just(())
            .setFailureType(to: Failure.self)
            .delay(for: dueTime, scheduler: scheduler, options: options)
            .flatMap { self.publisher.receive(on: scheduler) }
            .eraseToAnyPublisher()
        )
      )
      .cancellable(id: id, cancelInFlight: true)
    }
  }
  
  public func debounce<S: Scheduler>(
    id: Any.Type,
    for dueTime: S.SchedulerTimeType.Stride,
    scheduler: S,
    options: S.SchedulerOptions? = nil
  ) -> Self {
    self.debounce(id: ObjectIdentifier(id), for: dueTime, scheduler: scheduler, options: options)
  }
}
```

ê¸°ë³¸ì ìœ¼ë¡œ ìœ„ì˜ debounce êµ¬í˜„ìœ¼ë¡œ ì´ë¤„ì ¸ìˆìŠµë‹ˆë‹¤.

ë³´ì‹œë©´ íŒŒë¼ë¯¸í„°ë¡œ **Hashableí•œ ì‹ë³„ì idì™€ ì–¼ë§ˆë‚˜ ì§€ì—°ì‹œí‚¬ì§€ì— ëŒ€í•œ dueTime**ì„ ë°›ìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³  **ì–´ëŠ ìŠ¤ì¼€ì¥´ëŸ¬ì—ì„œ ëŒì•„ê°ˆì§€ì™€ ì–´ë–¤ ìŠ¤ì¼€ì¥´ ì˜µì…˜ì„ ì‚¬ìš©í• ì§€ë¥¼ ê¸°ë³¸ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ìš”.**

ë‚´ë¶€ êµ¬í˜„ì„ ë³´ì‹œë©´ Combineì˜ Justë¥¼ ì´ìš©í•˜ê³  delay ë©”ì„œë“œë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

ì¦‰ ë‹¨ìˆœ ì§€ì—°ì„ ì‹œì¼œì£¼ëŠ” êµ¬í˜„ ê·¸ ìì²´ì…ë‹ˆë‹¤.

ì•„ë˜ ë©”ì„œë“œëŠ” id ì‹ë³„ìë¥¼ Hashableí•œ ê°’ì„ ë„˜ê²¨ì£¼ì§€ ì•Šì„ë•Œ ìœ„ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ì—¬ ë§Œë“¤ì–´ì£¼ê²Œ ë©ë‹ˆë‹¤.

ê²°êµ­ êµ¬í˜„ì€ ë™ì¼í•©ë‹ˆë‹¤.

**ì´ë¡œì¨ ìš°ë¦¬ëŠ” TCAì—ì„œ debounceê°€ Effect ì‹¤í–‰ì— ì§€ì—°ì„ ê±¸ì–´ì¤Œì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**



> ê·¸ëŸ¼ ì´ debounce ë©”ì„œë“œë¥¼ ìš°ë¦¬ëŠ” TCAì˜ Effectì—ì„œ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ êµ¬í˜„í•´ë³´ê² ìŠµë‹ˆë‹¤ğŸ•ºğŸ»



#### **TCAì—ì„œì˜ Debouncing ì‚¬ìš© êµ¬í˜„**

```
import ComposableArchitecture

// ë¦¬ë“€ì„œ êµ¬í˜„ë¶€

...
struct SearchID: Hashable {}
...

case let .textChanged(text):
  return environment.search(text)
    .debounce(id: SearchID(), for: 0.5, scheduler: environment.mainQueue)
    .map(Action.searchResponse)
...
```

ìœ„ ë¦¬ë“€ì„œ êµ¬í˜„ë¶€ë¥¼ ë³´ì‹œì£ .

ìš°ì„  **SearchIDë¼ëŠ” Hashableí•œ êµ¬ì¡°ì²´ë¥¼ ì •ì˜**í•©ë‹ˆë‹¤.

ê·¸ë¦¬ê³  textChangedë¼ëŠ” ì•¡ì…˜ì´ ì‹¤í–‰ë ë•Œ ì‚¬ì´ë“œì´í™íŠ¸ ë‹¨ì—ì„œ searchë¼ëŠ” ë™ì‘ì„ ìˆ˜í–‰í•´ì¤ë‹ˆë‹¤.

ì¦‰ í…ìŠ¤íŠ¸ë¥¼ ë°›ì•„ ê²€ìƒ‰í•´ì£¼ëŠ”ê²ƒì´ì£ .

ê·¸ëŸ°ë° ê³„ì† ë°”ë€ŒëŠ” í…ìŠ¤íŠ¸ì— ëŒ€í•´ ê²€ìƒ‰í•˜ë©´ ê³¼ë¶€í•˜ê°€ ì˜¬ ìˆ˜ ìˆìœ¼ë‹ˆ **0.5ì´ˆë¼ëŠ” ì§€ì—° ì‹œê°„**ì„ ê±¸ì–´ì£¼ê³  ì‹¶ì–´ìš”.

ì•ì„œ ë§í–ˆë˜ ìë™ì™„ì„± ê¸°ëŠ¥ í˜¹ì€ ì—°ê´€ ê²€ìƒ‰ì–´ íƒìƒ‰ ê¸°ëŠ¥ì˜ ì—­í• ì„ í•˜ëŠ” ì•¡ì…˜ì¸ê²ƒ ê°™ìŠµë‹ˆë‹¤.

debounce ë©”ì„œë“œë¥¼ ì‚¬ìš©í•´ ì‹ë³„í•  ìˆ˜ ìˆëŠ” Hashableí•œ SearchID ì¸ìŠ¤í„´ìŠ¤ë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤.

forì€ dueTimeì˜ ë ˆì´ë¸”ë¡œ 0.5ì´ˆë¥¼ ì§€ì •í•´ì¤˜ìš”.

ìŠ¤ì¼€ì¥´ë§ì€ ë©”ì¸ íì—ì„œ ë™ì‘í•˜ë„ë¡ í•©ë‹ˆë‹¤.

ê·¸ ë‹¤ìŒ debounceëœ Effectë¥¼ searchResponse ë‚´ë¶€ ì•¡ì…˜ì— ë§µí•‘í•´ì¤ë‹ˆë‹¤.

**ìš”ëŸ¬ë©´ ì‹¤ì œì ì¸ ë™ì‘ì€ íƒ€ì´í•‘ì„ ê³„ì† í•˜ë”ë¼ë„ 0.5ì´ˆ ì§€ì—°ì´ ê±¸ë ¤ ìˆëŠ” ë™ì•ˆì˜ ë“¤ì–´ì˜¨ textëŠ” ë¬´ì‹œë ê²ƒì´ê³  ê·¸ í›„ íƒ€ì´í•‘ ëœ í…ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê³  search í•´ì¤ë‹ˆë‹¤.**



#### **ë§ˆë¬´ë¦¬**

ì ì´ë ‡ê²Œ TCAì—ì„œ ë””ë°”ìš´ìŠ¤ë¥¼ ê±°ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤!

ë””ë°”ìš´ìŠ¤ ê°œë…ì„ ì²˜ìŒ ë“¤ì–´ë³´ë©´ ë‚œí•´í•  ìˆ˜ ë„ ìˆì§€ë§Œ ì•Œê³  ê³„ì…¨ë˜ ê°œë…ì´ë¼ë©´ TCAë¼ê³  ë‹¤ë¥¼ê²ƒ ì—†ì´ ê°„ë‹¨í•œ êµ¬í˜„ìœ¼ë¡œ êµ¬ì„±ëœê±¸ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ğŸ™Œ



#### **[ì°¸ê³ ìë£Œ]**

https://github.com/pointfreeco/swift-composable-architecture/blob/main/Sources/ComposableArchitecture/Effects/Publisher/Debouncing.swift

[GitHub - pointfreeco/swift-composable-architecture: A library for building applications in a consistent and understandable way, A library for building applications in a consistent and understandable way, with composition, testing, and ergonomics in mind. - GitHub - pointfreeco/swift-composable-architecture: A library for bu...github.com](https://github.com/pointfreeco/swift-composable-architecture/blob/main/Sources/ComposableArchitecture/Effects/Publisher/Debouncing.swift)

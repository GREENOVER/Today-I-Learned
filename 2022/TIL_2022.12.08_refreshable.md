## TIL (Today I Learned)

### 12ì›” 8ì¼ (ëª©)   

- ### [í•™ìŠµë‚´ìš©] 
   ### SwiftUI - refreshable
    ìš°ì„  í•´ë‹¹ ê¸°ëŠ¥ì€ iOS 15 ë¶€í„° ì‚¬ìš©ì´ ê°€ëŠ¥í•´ìš”!
    ì°¸ê³ ë¡œ WWDC2021ì—ì„œ ì†Œê°œë˜ì—ˆìŠµë‹ˆë‹¤.
    ë¹„êµì  ì–´ë–»ê²Œ ë³´ë©´ ìµœì‹  ë©”ì„œë“œì´ê¸°ì— í˜„ì—…ì—ì„œ 13, 14ë¶€í„° ì§€ì›ì„ í•œë‹¤ë©´ ì‚¬ìš©í•  ìˆœ ì—†ìŠµë‹ˆë‹¤.
    ê·¸ë ‡ì§€ë§Œ ì•ìœ¼ë¡œ ë¯¸ë‹ˆë©ˆ íƒ€ê²Ÿì€ ì ì°¨ ì˜¬ë ¤ê°ˆê²ƒì´ê³  ë°°ì›Œë‘ë©´ ì¢‹ê¸°ì— ì´ì°¸ì— í•œë²ˆ íŠ¸ë¼ì´ í•´ë´…ë‹ˆë‹¤ğŸ™Œ

    ì—¬ëŸ¬ë¶„ ëª¨ë‘ í…Œì´ë¸”ë·° í˜¹ì€ ì»¬ë ‰ì…˜ë·°ë¡œ ëœ ì¦‰, ë¦¬ìŠ¤íŠ¸ë¡œ ë°ì´í„°ê°€ ë¿Œë ¤ì§„ ë·°ì˜ ê²½ìš° ìµœìƒë‹¨ì—ì„œ ì•„ë˜ë¡œ ë“œë˜ê¹… ì‹œ ìƒˆë¡œ ê³ ì¹¨ì´ ë˜ë©´ì„œ ë°ì´í„°ë¥¼ ìµœì‹ ìœ¼ë¡œ ê°±ì‹ í•˜ëŠ” ê·¸ëŸ° ê¸°ëŠ¥ì„ ê°€ì§„ ì•±ì„ ì•„ì£¼ ë§ì´ ë³´ì…¨ê³  ìµìˆ™í•˜ì‹¤ê±°ë¼ ìƒê°í•©ë‹ˆë‹¤.
    ëª¨ë‘ì—ê²Œ ì‚¬ì‹¤ì€ ì¹œìˆ™í•œ ê¸°ëŠ¥ì´ê¸´í•œë° SwiftUIì—ì„œ APIë¡œ ì œê³µí•˜ì§„ ì•Šì•˜ìŠµë‹ˆë‹¤.
    ê·¸ëŸ°ë° 15ì—ì„œë¶€í„° ì•„ì£¼ ì†ì‰½ê²Œ ì‚¬ìš© ê°€ëŠ¥í•˜ë„ë¡ ì œê³µì´ ë˜ì—ˆì£ ğŸ˜€

    ê·¸ëŸ¼ ê±°ë‘ì ˆë¯¸í•˜ê³  ë°”ë¡œ ì–´ë–¤ ë©”ì„œë“œì¸ì§€ ì–´ë–»ê²Œ ì‚¬ìš©í•˜ëŠ”ì§€ ë³´ì‹œì£ !

    #### refreshable?

    SwiftUIì—ì„œ Listì˜ ë·°ë¥¼ ìƒˆë¡œ ê³ ì¹¨ í•´ì¤ë‹ˆë‹¤.
    ì„¤ëª… ë„ì•~ğŸ‘ğŸ‘ğŸ‘
    í•œë§ˆë””ë¡œ ì •ì˜ê°€ ëë‚¬ìŠµë‹ˆë‹¤.
    í•´ë‹¹ ë©”ì„œë“œë¥¼ ë·° ëª¨ë””íŒŒì´ì–´ë¡œ ë¶™ì´ë©´ ì•„ë˜ ë“œë˜ê¹…í•˜ì—¬ ìƒˆë¡œ ê³ ì¹¨ì„ í•  ìˆ˜ ìˆë„ë¡ ì œê³µí•´ì¤€ë‹¤ëŠ”ê±°ì£ .
    ```swift
    func refreshable(action: @escaping () async -> Void) -> some View
    ```
    ì„ ì–¸ì€ ì´ë ‡ìŠµë‹ˆë‹¤.
    í•´ë‹¹ ë·° ëª¨ë””íŒŒì´ì–´ë¥¼ í†µí•´ asyncí•œ íƒˆì¶œ í´ë¡œì €ë¥¼ ì‹¤í–‰ì‹œí‚µë‹ˆë‹¤.
    ì£¼ë¡œ ìµœì‹ ì˜ ë°ì´í„°ë¥¼ ë‹¤ì‹œ fetchí•˜ëŠ” ì‘ì—…ì´ ì´ë¤„ì§€ëŠ”ê²Œ ë§ì„ê²ƒ ê°™ì•„ìš”.
    ì‚¬ìš©ìê°€ ìƒˆë¡œ ê³ ì¹¨ì„ ìš”ì²­í•  ë•Œ ë°œìƒí•˜ëŠ” SwiftUIê°€ ì‹¤í–‰í•˜ëŠ” ë¹„ë™ê¸° ì²˜ë¦¬ê¸°ì£ .
    ì‹¤í–‰ ì½”ë“œ ì• await í‚¤ì›Œë“œë¥¼ ì‚¬ìš©í•´ ë¹„ë™ê¸° í˜¸ì¶œì„ í•´ì£¼ë„ë¡ í•©ë‹ˆë‹¤.
    ìœ„ì™€ ê°™ì€ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë¦¬ìŠ¤íŠ¸ì—ì„œ ì•„ë˜ ë“œë˜ê¹…ì„ í†µí•´ ìƒˆë¡œ ê³ ì¹¨ì„ í•´ì£¼ì§€ë§Œ ì´ë¥¼ ì»¤ìŠ¤í…€í•œ ë·°ì— ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ì¦‰, ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆë¡œ ê³ ì¹¨ì„ í•œë‹¤ë˜ì§€ ë“±ì˜ ì¡°ê¸ˆ ë” ì»¤ìŠ¤í…€í•œ êµ¬ì„±ì´ RefreshAction ì¸ìŠ¤í„´ìŠ¤ ì„¤ì •ìœ¼ë¡œ ê°€ëŠ¥í•˜ì£ .
    ì´ê±´ ë˜ ì•„ë˜ì—ì„œ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤ğŸ™‹ğŸ»

    ê·¸ëŸ¼ ìš°ì„  refreshable ë©”ì„œë“œë¥¼ ì˜ˆì‹œë¥¼ í†µí•´ ì‚¬ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤!

    #### refreshable ì‚¬ìš©í•˜ê¸°
    ```swift
    import SwiftUI

    struct ContentView: View {
      @State var colors: [Color] = []

      var body: some View {
        VStack(spacing: 10) {
          Text("Colors")
            .font(.largeTitle)
            .padding(.top, 50)

          List(colors, id: \.self) { color in
            RoundedRectangle(cornerRadius: 10)
              .frame(width: 300, height: 50)
              .foregroundColor(color)
          }
          .onAppear {
            colors = initColors()
          }
          .refreshable {
            await colors.append(contentsOf: addColors())
          }

          Spacer()
        }
      }

      private func initColors() -> [Color] {
        return [.yellow, .green, .indigo, .orange, .purple]
      }

      private func addColors() async -> [Color] {
        return [.red, .blue, .gray]
      }
    }
    ```
    ì €ëŠ” ë³„ë„ í†µì‹ ì„ í•´ì£¼ì§€ ì•Šê³  ì•¼ë§¤ë¡œ ë°ì´í„°ë¥¼ ë„£ì—ˆìŠµë‹ˆë‹¤!
    ê·¸ë ‡ê¸°ì— await, asyncë¥¼ ì‚¬ì‹¤ ì‚¬ìš©í•˜ì§€ ì•Šì•„ë„ ë¬´ë°©í•˜ê¸´ í•´ìš”ã…ã…
    ìš°ì„  Listì— ë‹¤ì–‘í•œ ìƒ‰ìƒì˜ ë‘¥ê·¼ ì‚¬ê°í˜•ì„ ì´ˆê¸°ì— 5ê°œ ë§Œë“¤ì–´ì£¼ê³  ì´í›„ refresh ë  ë•Œ 3ê°œë¥¼ ì¶”ê°€í•´ì£¼ëŠ” ë¡œì§ì…ë‹ˆë‹¤.
    ì•„ì£¼ ì‚¬ìš©ì´ ì‰½ìŠµë‹ˆë‹¤ã…ã…
    ì¶”í›„ì— ì‹¤ ë°ì´í„° í†µì‹ ì˜ ì—­í• ì„ addColors ë©”ì„œë“œ ëŒ€ì‹  ê°ˆì•„ë¼ì›Œ ë°ì´í„°ë¥¼ ê°±ì‹ í•´ì˜¤ëŠ” ë¡œì§ì„ ê°€ì ¸ê°€ë©´ ë©ë‹ˆë‹¤ğŸ™Œ

    ê·¸ëŸ¼ ì´ì–´ì„œ ì•„ê¹Œ ì§šê³  ë„˜ì–´ê°€ìë˜ RefreshActionì— ëŒ€í•´ ì•Œì•„ë³´ê² ìŠµë‹ˆë‹¤!

    #### RefreshAction?

    ìœ„ì—ì„œ ê°„ë‹¨íˆ ì–¸ê¸‰í–ˆë“¯ì´ ìƒˆë¡œ ê³ ì¹¨ì„ ì‹œì‘í•  ìˆ˜ ìˆë„ë¡ í•´ì£¼ëŠ” ì‘ì—…ì…ë‹ˆë‹¤.
    ```swift
    struct RefreshAction
    ```
    êµ¬ì¡°ì²´ íƒ€ì…ì´ë©°, ê¸°ë³¸ì ìœ¼ë¡œ refresh í™˜ê²½ ê°’ì— í•´ë‹¹ ì¸ìŠ¤í„´ìŠ¤ê°€ í¬í•¨ë˜ì–´ ìˆì–´ ê¸°ë³¸ ë·°ì˜ Environmentê°€ ìƒˆë¡œ ê³ ì¹¨ì„ ì œê³µí•´ì£¼ì£ .
    ë””í´íŠ¸í•˜ê²Œ ì´ Environmentì˜ ê°’ì€ nilì´ì§€ë§Œ refreshable ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì˜€ì„ë•Œ ì§€ì •í•œ ì²˜ë¦¬ë¥¼ í•˜ëŠ” ìƒˆë¡œ ê³ ì¹¨ ì‘ì—…ì„ í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ì´ì œ RefreshActionì„ ì´ìš©í•´ ì»¤ìŠ¤í…€í•œ ë·°ë¥¼ ë§Œë“¤ì–´ ìƒˆë¡œ ê³ ì¹¨ì„ í•´ì¤„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    refresh Environment ë³€ìˆ˜ë¥¼ ì´ìš©í•˜ë©´ ë©ë‹ˆë‹¤ğŸ™Œ
    ì•„ë˜ ì˜ˆì‹œë¥¼ ë“¤ì–´ë³´ê² ìŠµë‹ˆë‹¤. (ê³µì‹ë¬¸ì„œ ì°¸ê³ í•œ ì˜ˆì‹œ!)
    ```swift
    struct RefreshableView: View {
      @Environment(\.refresh) private var refresh

      var body: some View {
        Button("Refresh") {
          Task {
            await refresh?()
          }
        }
        .disabled(refresh == nil)
      }
    }
    ```
    refreshë¥¼ callAsFunction ì´ìš©í•´ ì§ì ‘ ì •ì˜í•˜ê³  í˜¸ì¶œí•˜ëŠ” ë©”ì„œë“œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ì—¬ê¸°ì„œ callAsFunctionì€ ìƒˆë¡œ ê³ ì¹¨ ì‘ì—…ì„ ì‹œì‘í•˜ëŠ” ë©”ì„œë“œì…ë‹ˆë‹¤.
    í˜¸ì¶œì´ ë¹„ë™ê¸°ì ì´ë¯€ë¡œ Taskì™€ awaitë¥¼ ì´ìš©í•©ë‹ˆë‹¤.

    ì„¤ëª…ì´ ì¡°ê¸ˆ ë³µì¡í•  ìˆ˜ ìˆëŠ”ë° ì‚¬ìš©ì€ ì–´ë µì§€ ì•Šìœ¼ë‹ˆ ë°”ë¡œ ì‚¬ìš©ë²•ì„ ë³´ì‹œì£ ğŸ•ºğŸ»

    #### ì»¤ìŠ¤í…€í•˜ê²Œ ìƒˆë¡œ ê³ ì¹¨ ê¸°ëŠ¥ ì‚¬ìš©í•˜ê¸°
    ```swift
    import SwiftUI

    struct ContentView: View {
      @State var colors: [Color] = []

      var body: some View {
        VStack(spacing: 10) {
          Text("Colors")
            .font(.largeTitle)
            .padding(.top, 50)

          List(colors, id: \.self) { color in
            RoundedRectangle(cornerRadius: 10)
              .frame(width: 300, height: 50)
              .foregroundColor(color)
          }
          .onAppear {
            colors = initColors()
          }

          CustomRefresher()
            .refreshable {
              await colors.append(contentsOf: addColors())
            }

          Spacer()
        }
      }

      private func initColors() -> [Color] {
        return [.yellow, .green, .indigo, .orange, .purple]
      }

      private func addColors() async -> [Color] {
        return [.red, .blue, .gray]
      }
    }

    struct CustomRefresher: View {
      @Environment(\.refresh) private var refresh

      var body: some View {
        Group {
          if let refresh = refresh {
            Button(
              action: {
                Task {
                  await refresh()
                }
              },
              label: {
                Text("Refresh Button")
              }
            )
          }
        }
      }
    }
    ```
    CustomRefresherë¼ëŠ” ë·°ë¥¼ ë§Œë“¤ì–´ì¤ë‹ˆë‹¤.
    refresh Environment ë³€ìˆ˜ë¥¼ ê°€ì§€ì£ !
    ë²„íŠ¼ì˜ action ë™ì‘ìœ¼ë¡œ ë¹„ë™ê¸° ì‘ì—…ì„ ìœ„í•´ Taskì— refreshì˜ callAsFunctionì„ í˜¸ì¶œí•´ì£¼ë„ë¡ í•©ë‹ˆë‹¤.
    ì´ ì»¤ìŠ¤í…€í•œ ë·°ë¥¼ ì›í•˜ëŠ”ê³³ì— ë°°ì¹˜í•˜ê³  ìœ„ì—ì„œ ì•Œì•„ë³¸ refreshable ë©”ì„œë“œë¥¼ í†µí•´ êµ¬í˜„í•´ì£¼ë©´ ëğŸ™Œ

    #### ë§ˆë¬´ë¦¬

    ì´ë ‡ê²Œ ì˜¤ëŠ˜ë„ SwiftUIì˜ ì ë‹¹í•œ ê´œì°®ì€ ê¸°ëŠ¥ì„ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤!
    í•´ë‹¹ ìœ„ ì˜ˆì‹œ ì½”ë“œë“¤ì€ ì•„ë˜ ì œ ê¹ƒí—™ì—ë„ ìˆìœ¼ë‹ˆ ì°¸ê³ í•˜ì‹¤ë¶„ë“¤ì€ ì°¸ê³ í•˜ì…”ë„ ì¢‹ê² ìŠµë‹ˆë‹¤ğŸ˜Š
    https://github.com/GREENOVER/playground/tree/main/refreshable

    #### [ì°¸ê³ ìë£Œ]
    https://green1229.tistory.com/310
    https://developer.apple.com/documentation/swiftui/view/refreshable(action:) 
    https://developer.apple.com/documentation/swiftui/refreshaction
## TIL (Today I Learned)

### 10ì›” 11ì¼ (í™”)    

- #### [í•™ìŠµë‚´ìš©] 
    #### TCA - IfLetStore

    #### IfLetStore??    

    í•´ë‹¹ êµ¬ì¡°ì²´ëŠ” SwiftUIë¥¼ ì„í¬íŠ¸í•˜ì—¬ ì‚¬ìš©í•˜ê³  ìˆê¸°ì— ì£¼ë¡œ SwiftUI í™˜ê²½ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
    ê·¸ëŸ¼ ì´ êµ¬ì¡°ì²´ íƒ€ì…ì€ ì–´ë–¨ë•Œ ì“°ëŠ”ì§€ ì •ì˜ë¥¼ í•´ë³´ê² ìŠµë‹ˆë‹¤.
    ë‘ ë·° ì¤‘ í•˜ë‚˜ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ì„œ ì˜µì…”ë„í•œ ìƒíƒœì˜ Storeë¥¼ ì•ˆì „í•˜ê²Œ ì–¸ë˜í•‘ í•˜ëŠ” ë·°ì…ë‹ˆë‹¤.
    ê¸°ë³¸ State, ì¦‰ ìƒíƒœê°€ nilì´ ì•„ë‹ë•Œ then í´ë¡œì €ê°€ Storeë¥¼ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.
    ë§Œì•½ ì˜µì…”ë„ ìƒíƒœê°€ ì•„ë‹ ê²½ìš°(í•´ë‹¹ë˜ì§€ ì•Šì„ë•Œ, ìƒíƒœê°€ nilì¼ë•Œ) else í´ë¡œì €ë¥¼ ìˆ˜í–‰í•˜ê²Œ ë©ë‹ˆë‹¤.
    ì¦‰ ì •ë¦¬í•´ë³´ë©´ ì´ ê¸°ëŠ¥ ìì²´ëŠ” ìƒíƒœ, Stateì— ë”°ë¼ ë‘ ë·°ì¤‘ í•˜ë‚˜ë¥¼ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ê²°ì •ë˜ëŠ”ë° ì“°ì…ë‹ˆë‹¤.

    ìŒ... ì¡°ê¸ˆ ë§ì´ ì–´ë ¤ìš¸ ìˆ˜ ìˆì–´ìš”.
    ê·¸ëŸ°ë° ì •ì˜ê°€ ê·¸ëŸ°ê±°ì§€ ì‹¤ì œë¡œ êµ¬í˜„ì„ ë³´ê³  ëŠë‚€ë‹¤ë©´ ì‰¬ìš¸ê±°ì—ìš”.
    ê°™ì´ í•´ë³´ì‹œì£ !

    #### IfLetStore êµ¬í˜„ ì •ì˜

    ê·¸ëŸ¼ IfLetStoreì˜ ì •ì˜ê°€ ì–´ë–»ê²Œ êµ¬í˜„ë˜ì–´ ìˆëŠ”ì§€ ì•„ë˜ ì½”ë“œë¥¼ ë³´ì‹œì£ .
    ```swift
    public struct IfLetStore<State, Action, Content: View>: View {
      private let content: (ViewStore<State?, Action>) -> Content
      private let store: Store<State?, Action>

      public init<IfContent, ElseContent>(
        _ store: Store<State?, Action>,
        @ViewBuilder then ifContent: @escaping (Store<State, Action>) -> IfContent,
        @ViewBuilder else elseContent: @escaping () -> ElseContent
      ) where Content == _ConditionalContent<IfContent, ElseContent> {
        self.store = store
        self.content = { viewStore in
          if var state = viewStore.state {
            return ViewBuilder.buildEither(
              first: ifContent(
                store.scope {
                  state = $0 ?? state
                  return state
                }
              )
            )
          } else {
            return ViewBuilder.buildEither(second: elseContent())
          }
        }
      }

      public init<IfContent>(
        _ store: Store<State?, Action>,
        @ViewBuilder then ifContent: @escaping (Store<State, Action>) -> IfContent
      ) where Content == IfContent? {
        self.store = store
        self.content = { viewStore in
          if var state = viewStore.state {
            return ifContent(
              store.scope {
                state = $0 ?? state
                return state
              }
            )
          } else {
            return nil
          }
        }
      }

      public var body: some View {
        WithViewStore(
          self.store,
          removeDuplicates: { ($0 != nil) == ($1 != nil) },
          content: self.content
        )
      }
    }
    ```
    ì´ë ‡ê²Œ ê°„ë‹¨í•˜ê²Œ? êµ¬í˜„ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    ìš°ì„  Stateì™€ Action, Contentë¥¼ ì œë„¤ë¦­í•˜ê²Œ ë°›ìœ¼ë©° View í”„ë¡œí† ì½œì„ ë”°ë¦…ë‹ˆë‹¤.
    ì¦‰ Viewë¼ëŠ” ì†Œë¦¬ì¼ê²ƒì´ê³  Contentë„ View í”„ë¡œí† ì½œì„ ë”°ë¥´ë‹ˆ ë§ˆì°¬ê°€ì§€ë¡œ Viewë¥¼ ë‚˜íƒ€ëƒ…ë‹ˆë‹¤.
    ì‚¬ìš©ë˜ëŠ” í”„ë¡œí¼í‹°ë¥¼ ë³´ë©´ ViewStoreë¥¼ ë°›ì•„ Content(View)ë¥¼ ë±‰ì–´ì£¼ëŠ” contentì™€ Store íƒ€ì…ì˜ storeê°€ ìˆìŠµë‹ˆë‹¤.
    ì•„ë˜ ë‘ê°œì˜ ì´ë‹ˆì…œë¼ì´ì €ë¥¼ ë³´ê² ìŠµë‹ˆë‹¤.

    ì²«ë²ˆì§¸ ì´ë‹ˆì…œë¼ì´ì €ë¡œëŠ” then íŒŒë¼ë¯¸í„°ì™€ else íŒŒë¼ë¯¸í„°ê°€ ìˆìŠµë‹ˆë‹¤.
    ëª¨ë‘ ViewBuilder í”„ë¡œí¼í„°ë˜í¼ë¥¼ ì‚¬ìš©í•œ íƒ€ì…ì´ì£ ?
    thenìœ¼ë¡œ ë„£ì–´ì¤€ ë·°ëŠ” ì¡°ê±´ì„ íŒë³„í•  stateì˜ ê°’ì´ nilì´ ì•„ë‹ë•Œ ë³´ì—¬ì¤„ ë·°ë¥¼ ë‚˜íƒ€ë‚´ê³ ,
    elseë¡œ ë„£ì–´ì¤€ ë·°ëŠ” state ê°’ì´ nilì¼ë•Œ ë³´ì—¬ì¤„ ë·°ë¥¼ ë‚˜íƒ€ë‚´ì¤ë‹ˆë‹¤.
    ê·¸ë˜ì„œ ì´ ë‘ íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì§€ê³  ë‚´ë¶€ í”„ë¡œí¼í‹°ì¸ contentë¥¼ ë§Œë“¤ì–´ ì£¼ê²Œ ë©ë‹ˆë‹¤.
    ì´ì— ëŒ€í•œ íŒë³„ ë˜í•œ where ì¡°ê±´ì„ í†µí•´ _ConditionalContent íƒ€ì…ì—ì„œ IfContentì™€ ElseContentë¥¼ ì œë„¤ë¦­ìœ¼ë¡œ ë°›ì•„ íŒë³„í•´ì£¼ì£ .

    ë‘ë²ˆì§¸ ì´ë‹ˆì…œë¼ì´ì €ëŠ” ë³´ì‹œë©´ else íŒŒë¼ë¯¸í„°ê°€ ì—†ì£ ?
    ê·¸ë§ì¸ ì¦‰ìŠ¨ elseì¼ ê²½ìš° ë³„ë„ ë·°ë¥¼ ì£¼ì§€ ì•Šì•„ë„ ì—ëŸ¬ê°€ ë‚˜ì§€ ì•Šìœ¼ë©° ë‹¨ìˆœíˆ ë·°ì˜ ë…¸ì¶œì´ ì—†ë‹¤ëŠ” ì°¨ì´ê°€ ìˆìŠµë‹ˆë‹¤.

    ì¦‰ then íŒŒë¼ë¯¸í„°ë“  else íŒŒë¼ë¯¸í„°ë“  ì›í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ì¡°í•©í•´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ê·¸ë ‡ê²Œ ì´ë‹› ì‹œ ì •í•´ì§„ contentë¥¼ ê°€ì§€ê³  ì‹¤ì œë¡œ Viewì˜ bodyë¥¼ ë§Œë“¤ì–´ì£¼ê²Œ ë©ë‹ˆë‹¤.

    ê·¸ëŸ¼ ì´ì œ ì–´ë–»ê²Œ ì—¬ëŸ¬ ë°©ë©´ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”ì§€ ë³´ê² ìŠµë‹ˆë‹¤!

    #### IfLetStore ì‚¬ìš©ë²•
    ```swift
    // else ì‚¬ìš©
    IfLetStore(
      store.scope(state: \SearchState.results, action: SearchAction.results),
    ) {
      SearchResultsView(store: $0)
    } else: {
      Text("Loading search results...")
    }

    // then ì‚¬ìš©
    IfLetStore(
      store.scope(state: \SearchState.results, action: SearchAction.results),
      then: { store in 
        SearchResultsView(store: store)
      }
    )

    // then, else ì‚¬ìš©
    IfLetStore(
      store.scope(state: \SearchState.results, action: SearchAction.results),
      then: { store in 
        SearchResultsView(store: store)
      },
      else: {
        Text("Loading search results...")
      }
    )
    ```
    ê¸°ë³¸ ì—¬ëŸ¬ ì‚¬ìš©ì€ ì´ë ‡ìŠµë‹ˆë‹¤.
    ì•„ê¹Œ ë§í–ˆë“¯ SearchStateê°€ ì•„ë§ˆ í•˜ìœ„ Stateì¼ê²ƒì´ê³  ìƒìœ„ Stateì—ì„œ ì´ Stateì˜ resultsê°’ì„ ì˜µì…”ë„ë¡œ ê°€ì§€ê³  ìˆì„ê²ƒ ê°™ì•„ìš”.
    ì¦‰ í•´ë‹¹ resultsê°’ì˜ ì´ˆê¸°ê°’ì€ nilì¼í…Œê³  ë¬´ì–¸ê°€ ê°’ì´ í• ë‹¹ì´ ë˜ë©´ SearchResultViewë¥¼ ë³´ì—¬ì£¼ê²Œ ë©ë‹ˆë‹¤.
    ì—¬ê¸°ì„œ else êµ¬ë¬¸ì„ ë³´ì‹œë©´ resultsê°’ì´ nilì´ì—¬ì„œ ê°’ì˜ í• ë‹¹ì´ ì´ë¤„ì§€ê¸° ì „ì´ë¼ë©´ Textë¥¼ ë³´ì—¬ì£¼ê²Œ ë©ë‹ˆë‹¤.
    ë§Œì•½ í•´ë‹¹ ê°’ì´ ì—†ì„ë•Œ ì•„ë¬´ ë·°ë„ ë‚˜íƒ€ë‚´ê³  ì‹¶ì§€ ì•Šë‹¤ë©´ ì´ else êµ¬ë¬¸ì€ ì—†ì–´ë„ ë©ë‹ˆë‹¤.
    ì•„ë˜ì²˜ëŸ¼ ì‚¬ìš©ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    ```swift
    .sheet(
      isActive: viewStore.binding(
        get: \.isGameActive,
        send: { $0 ? .startButtonTapped : .detailDismissed }
      )
    ) {
      IfLetStore(
        self.store.scope(state: \.detail, action: AppAction.detail)
      ) {
        DetailView(store: $0)
      }
    }
    ```
    ë³´ì‹œë©´ ì‹œíŠ¸ê°€ ë‚˜íƒ€ë‚˜ë©´ í•´ë‹¹ ì‹œíŠ¸ì— í•´ë‹¹í•˜ëŠ” ë·°ëŠ” DetailViewì¼ê²ƒì´ê³  ì´ ë·°ê°€ ë‚˜íƒ€ë‚˜ëŠ” ì¡°ê±´ì€ detail Stateê°€ nilì´ ì•„ë‹ˆì—¬ì•¼ í•©ë‹ˆë‹¤.
    ë§Œì•½ ì‹œíŠ¸ê°€ ë‚˜íƒ€ë‚ ë•Œ detailê°’ì´ nilì´ë©´ ë‚´ë¶€ì— ì•„ë¬´ ë·°ë„ ëœ¨ì§€ ì•Šì€ ë¹ˆ ì‹œíŠ¸ê°€ ë‚˜ì˜¬ê²ë‹ˆë‹¤.
    ì—¬ê¸°ì„œì˜ sheetViewê°€ ëœ¨ëŠ”ê²ƒê³¼ sheetView ë‚´ë¶€ì— ë³´ì—¬ì¤„ ë·°ëŠ” ë³„ê°œë¡œ ë™ì‘í•œë‹¤ ë³´ì‹œë©´ ë©ë‹ˆë‹¤ğŸ˜„
    
    #### ì°¸ê³ ìë£Œ
    https://green1229.tistory.com/288   

    #### ë§ˆë¬´ë¦¬

    ì´ë ‡ê²Œ ê°„ë‹¨í•œ ì£¼ì œì´ê¸°ë„ í•´ì„œ ê·¸ì— ë§ê²Œ ê°„ë‹¨íˆ IfLetStoreë¥¼ ì•Œì•„ë´¤ìŠµë‹ˆë‹¤!
    ì €ëŠ” ìì£¼ ì“°ê³  ìˆê¸°ì— ì˜ í™œìš©í•˜ë©´ ì¢‹ì„ ê²ƒ ê°™ìŠµë‹ˆë‹¤ğŸ™Œ

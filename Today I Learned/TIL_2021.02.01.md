## TIL (Today I Learned)

### 2ì›” 1ì¼ (ì›”)

- #### [í•™ìŠµë‚´ìš©]
ì˜¤ëŠ˜ì€ í‚¤ ì²´ì¸ì— ëŒ€í•´ í•™ìŠµí–ˆìŠµë‹ˆë‹¤. í‚¤ ì²´ì¸â€¦ ì—´ì‡ ë‹¤ë°œâ€¦ ë§ì´ ì‚¬ìš©í•˜ê³  ìˆëŠ”ë° ì˜ ëª¨ë¥´ëŠ” ê°œë…ì´ë¼ ë‹¤ì‹œ í•œë²ˆ ì •ë¦¬í•´ë³´ì•˜ìŠµë‹ˆë‹¤ğŸ§

  - ìš°ì„  í‚¤ì²´ì¸ì´ë€ ë¬´ì—‡ì¸ê°€!?
: í‚¤ì²´ì¸ì€ ë°ì´í„°ë² ì´ìŠ¤ì— ì•”í˜¸í™”ëœ ë°ì´í„°ì˜ ì‘ì€ ëª¨ìŒë“¤ì„ ì €ì¥í•˜ëŠ” ë§¤ì»¤ë‹ˆì¦˜ (ì—´ì‡ ë‹¤ë°œ)ë¡œ í‘œí˜„ë©ë‹ˆë‹¤!

1. ìœ ì € ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ë°©ë²•ë“¤
Â 1) Keyed Archiver: coreDataë³´ë‹¤ ëœ ë³µì¡í•˜ê³  ëŠë¦¬ì§€ë§Œ ì‚¬ìš©ì´ ê°„ë‹¨í•˜ë‹¤. ì €ì¥í•  ë°ì´í„°ê°€ NSConfig í”„ë¡œí† ì½œì„ ì±„íƒí•´ì•¼í•˜ë©°
Â  Â  ë°ì´í„°ë¥¼ ì €ì¥í•  ì‹œ í‚¤/ì´ë¦„ìœ¼ë¡œ ì¸ì½”ë”©ì„í•˜ê³  êº¼ë‚¼ë•Œ ë””ì½”ë”©ì„ ì´ìš©í•œë‹¤.
Â 2) CoreData: UserDefaultë³´ë‹¤ ë” ë³µì¡í•˜ì§€ë§Œ ì €ì¥ëœ ì •ë³´ì— êµ¬ì¡°ê°€ í•„ìš”í•  ë•Œ ìœ ìš©í•˜ë‹¤.
Â  Â  Â ëŒ€ìš©ëŸ‰ ë°ì´í„° ì €ì¥ì— ì‚¬ìš©ë˜ëŠ” ê´€ê³„í˜• DB, ê°„ë‹¨í•œ UIì—ì„œ ìë™ìœ¼ë¡œ ëª¨ë¸ì„ ìƒì„±
Â 3) User Defaults: ë°ì´í„°ë¥¼ ì €ì¥ ë° ìœ ì§€í•˜ëŠ” ê°€ì¥ ê°„ë‹¨í•œ ë°©ë²•ìœ¼ë¡œ ë°ì´í„°ë¥¼ êµ¬ì¡°í™”í•˜ì§€ ì•ŠëŠ”ë‹¤.
Â  Â  Â (User Preference ê°™ì€ ì •ë³´ë¥¼ ì €ì¥í• ë•Œ ì ë‹¹í•˜ë‹¤.)

2. 1ì˜ ë°©ë²•ê³¼ KeyChainì˜ ì°¨ì´ì 
Â 1) User DefaultsëŠ” info.plistì— ë°ì´í„°(íŒ¨ìŠ¤ì›Œë“œ ë“±)ê°€ ì €ì¥ë˜ê¸°ì— ì•±ì´ ì‚­ì œë˜ë©´ ì •ë³´ë„ ì‚­ì œë˜ì§€ë§Œ í‚¤ ì²´ì¸ì€ ë³„ë„ì˜ í‚¤ ì²´ì¸ì—
Â  Â  ë°ì´í„°ë¥¼ ì €ì¥í•¨ìœ¼ë¡œ ì•±ì´ ì‚­ì œë˜ë„ í‚¤ ì²´ì¸ì„ ì‚­ì œí•´ì£¼ê¸°ì „ì—ëŠ” ì‚­ì œë˜ì§€ ì•ŠëŠ”ë‹¤.
Â  Â -> ì €ì¥ ë° ë¡œë“œê°€ ì‰½ì§€ë§Œ í•´í‚¹ë„ ì‰½ë‹¤ (base64 ì¸ì½”ë”©í•˜ì—¬ plistì— ì €ì¥ë˜ê¸°ì—..)
Â 2) í‚¤ ì²´ì¸ ê·¸ë£¹ì„ ì‚¬ìš©í•˜ë©´ ë‹¤ë¥¸ ì•±ì—ì„œë„ ë°ì´í„° ê³µìœ  ê°€ëŠ¥ (ì—¬ëŸ¬ í™˜ê²½ì—ì„œ ì—°ë™ ê°€ëŠ¥)
Â 3) í‚¤ ì²´ì¸ì€ ê°€ì¥ ì•ˆì „í•˜ê³  ë¯¼ê°í•œ ë°ì´í„°ë¥¼ ì €ì¥ ë° ìœ ì§€í• ë•Œ ì‚¬ìš©í•˜ì§€ë§Œ ê°€ì¥ ëŠë¦¬ë‹¤.

3. Security
Â : ì•±ì—ì„œ ê´€ë¦¬í•˜ëŠ” ë°ì´í„°ë¥¼ ë³´í˜¸í•˜ê³  ì•±ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ë¥¼ ì œì–´í•˜ëŠ” í”„ë ˆì„ì›Œí¬
Â -. ë³´ì•ˆ í”„ë ˆì„ì›Œí¬ ì‚¬ìš© -> ì •ë³´ë³´í˜¸/ì‹ ë¢° êµ¬ì¶• -> ì†Œí”„íŠ¸ì›¨ì–´ ì•¡ì„¸ìŠ¤ ì œì–´
Â -. ì•”í˜¸í™”ëŠ” ì–´ë µê³  ë¹„ìš©ì´ í¬ê¸°ì— ìì²´ì ìœ¼ë¡œ ì•”í˜¸í™” ì†”ë£¨ì…˜ êµ¬ì¶•ì€ ì§€ì–‘í•œë‹¤.
Â  Â  (Security í”„ë ˆì„ì›Œí¬ ì‚¬ìš©ì„ ê¶Œì¥í•˜ê³  ìˆë‹¤.)

Â ![image-20210409093851046](/Users/chanwoo/Library/Application Support/typora-user-images/image-20210409093851046.png)

<Security Framework>

-. ë³´ì•ˆ ë„¤íŠ¸ì›Œí¬ í†µì‹  ì‹œ ë³´ì•ˆ í”„ë ˆì„ì›Œí¬ ê¸°ë°˜ìœ¼ë¡œ í•˜ëŠ” URL ë¡œë”© ì‹œìŠ¤í…œì„ ê³ ë ¤í•´ì•¼í•œë‹¤.

4. Keychain Services
Â : ì‚¬ìš©ìë¥¼ ëŒ€ì‹ í•´ ì‘ì€ ë°ì´í„° ëª¨ìŒì„ ì•ˆì „í•˜ê²Œ ì €ì¥í•´ì£¼ëŠ” ì„œë¹„ìŠ¤
Â -. KeyChain Services API: í‚¤ ì²´ì¸ì´ë¼ëŠ” ì•”í˜¸í™”ëœ DBì— ì‚¬ìš©ì ë°ì´í„°ì˜ ì‘ì€ ë¹„íŠ¸ë¥¼ ì €ì¥í•˜ëŠ” ë§¤ì»¤ë‹ˆì¦˜ì„ ì•±ì— ì œê³µí•´ì¤€ë‹¤.
Â  Â  (e.g. ì¸ì¦ì„œ, í‚¤/ì‹ ë¢° ì„œë¹„ìŠ¤ (ì•”í˜¸í™” í‚¤ ë° ì¸ì¦ì„œ))

![image-20210409093918247](/Users/chanwoo/Library/Application Support/typora-user-images/image-20210409093918247.png)

[í‚¤ ì²´ì¸ êµ¬ì„±ìš”ì†Œ]
Â 1) KeyChain Items
Â : í‚¤ ì²´ì¸ì— ì €ì¥ë˜ëŠ” ë°ì´í„°
Â 2) ItemClass
Â : ì•„ì´í…œì— ì €ì¥ë˜ëŠ” ë°ì´í„° ì¢…ë¥˜ (ì¸í„°ë„·íŒ¨ìŠ¤ì›Œë“œ/ì œë„¤ë¦­íŒ¨ìŠ¤ì›Œë“œ ë“±ë“±...)
Â 3) Attribute
Â : ì•„ì´í…œ í´ë˜ìŠ¤ì— ëŒ€í•œ ì†ì„±ê°’

[API Components]
Â 1) Keychain Items
Â : í‚¤ ì²´ì¸ì— ì €ì¥í•œ í•­ëª© (ë³´ì•ˆ ì •ë³´ í¬í•¨)
Â 2) Keychain
Â : macOSì—ì„œ ì „ì²´ í‚¤ ì²´ì¸ ìƒì„± ë° ê´€ë¦¬
Â 3) Access Control List
Â : macOSì˜ í‚¤ ì²´ì¸ í•­ëª© ì ‘ê·¼í•  ì•± ì œì–´

5. KeyChain Items
Â : í‚¤ ì²´ì¸ì— ì €ì¥í•œ í•­ëª© ë°ì´í„° (ë³´ì•ˆ ì •ë³´ í¬í•¨)
Â -. ì•”í˜¸í™” í‚¤ì— ì €ì¥í•˜ë ¤ë©´ í‚¤ ì²´ì¸ í•­ëª©ìœ¼ë¡œ íŒ¨í‚¤ì§•í•´ì•¼ëœë‹¤.
Â -. í•­ëª© ì ‘ê·¼ì„± ì œì–´ ë° ê²€ìƒ‰ì„ ê°€ëŠ¥í•˜ê²Œ ê³µê°œì ìœ¼ë¡œ í‘œì‹œë˜ëŠ” ì†ì„±ê°’ì˜ ëª¨ìŒì„ ì œê³µ

![image-20210409093929525](/Users/chanwoo/Library/Application Support/typora-user-images/image-20210409093929525.png)

Â 1) í‚¤ ì²´ì¸ ì•”í˜¸ ì¶”ê°€
Â : í‚¤ ì²´ì¸ì„ ì¶”ê°€í• ë•Œ ì•„ë˜ì™€ ê°™ì€ ì½”ë“œë¡œ êµ¬í˜„ëœë‹¤.
let account = credentials.username
let password = credentials.password.data(using: String.Encoding.utf8)!
var query: [String: Any] = [kSecClass as String: kSecClassInternetPassword,
                            kSecAttrAccount as String: account,
                            kSecAttrServer as String: server,
                            kSecValueData as String: password]
: í‚¤ ì²´ì¸ì„ ì¶”ê°€í•  ì‹œ ë‹¤ì–‘í•œ ë¶„ë¥˜ê°€ ìˆëŠ”ë° ìœ„ ë¶€ë¶„ì€ ì¸í„°ë„· ì•”í˜¸ì— ëŒ€í•œ í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•˜ëŠ” ê²½ìš°

![image-20210409093939759](/Users/chanwoo/Library/Application Support/typora-user-images/image-20210409093939759.png)

<í‚¤ ì²´ì¸ í´ë˜ìŠ¤>

![image-20210409093950334](/Users/chanwoo/Library/Application Support/typora-user-images/image-20210409093950334.png)

<Attribute>

: ìœ„ì˜ Attributeì—ì„œ í•„ìš”í•œ ì•”í˜¸í™” ì†ì„±ê°’ì„ ê³¨ë¼ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.

2) í‚¤ ì²´ì¸ í•­ëª© ì¶”ê°€
Â : SecItemAdd(_:_:)
`let status = SecItemAdd(query as CFDictionary, nil)`
`guard status == errSecSuccess else { throw KeychainError.unhandledError(status: status) }`
3) í‚¤ ì²´ì¸ í•­ëª© ë§¤ì¹­ ê²€ìƒ‰
: SecItemCopyMatching(_:_:)
`func SecItemCopyMatchi`ng(_ query: CFDictionary,` 
                       _ result: UnsafeMutablePointer<CFTypeRef?>?) -> OSStatus`
4) í‚¤ ì²´ì¸ í•­ëª© ìˆ˜ì •
: SecItemUpdate(_:_:)
-. ê²€ìƒ‰í•˜ì—¬ ì¼ì¹˜í•˜ëŠ” í•­ëª© ìˆ˜ì •
`func SecItemUpda`te(_ query: CFDictionary,` 
                 _ attributesToUpdate: CFDictionary) -> OSStatus`
5) í‚¤ ì²´ì¸ í•­ëª© ì‚­ì œ
: SecItemDelete(_:_:)
-. ê²€ìƒ‰í•˜ì—¬ ì¼ì¹˜í•˜ëŠ” í•­ëª© ì‚­ì œ
`func SecItemDelete(_ query: CFDictionary) -> OSStatus`

6. KeyChains
Â :macOSì—ì„œ ì „ì²´ í‚¤ ì²´ì¸ ìƒì„± ë° ê´€ë¦¬
Â -. iOSì—ì„œëŠ” ë‹¨ì¼ í‚¤ ì²´ì¸ë§Œ ì ‘ê·¼ ê°€ëŠ¥ (iCloud í‚¤ ì²´ì¸ í¬í•¨)--> ëª¨ë“  ì•±ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í•˜ë‚˜ì˜ í‚¤ ì²´ì¸ì„ ì œê³µÂ 
Â -. macOSì—ì„œëŠ” ì—¬ëŸ¬ í‚¤ ì²´ì¸ ì§€ì› (ì•±ì´ ì›í•˜ëŠ”ë§Œí¼ í‚¤ì²´ì¸ì„ ë§Œë“¤ ìˆ˜ ìˆìŒ)
Â  Â --> e.g. ì—¬ëŸ¬ í‚¤ì²´ì¸ ì¹´í…Œê³ ë¦¬ ë° ì´ë¦„ì„ ë§Œë“¤ì–´ ë”°ë¡œ ê´€ë¦¬

7. Access Control List (ACL)
Â : macOS í‚¤ ì²´ì¸ í•­ëª© ì ‘ê·¼ ì•± ì œì–´
Â -. í•´ë‹¹ í•­ëª©ì—ëŠ” ì‘ì—… ë°°ì—´ê³¼ ì‘ì—… ìˆ˜í–‰ ì‹ ë¢°í•  ìˆ˜ ìˆëŠ” ì•± ë°°ì—´ì´ í¬í•¨ ( ACLì´ í•´ë‹¹ í‚¤ ì²´ì¸ í•­ëª© ì ‘ê·¼ì„± ì œì–´)
Â 1)ì•±ì´ í‚¤ì²´ì¸ í•­ëª© ì—‘ì„¸ìŠ¤ ì‹œë„Â 
Â 2)ì‹œìŠ¤í…œì´ ACLì—ì„œ í•­ëª© íƒìƒ‰
Â 3)ì•¡ì„¸ìŠ¤ ê¶Œí•œ ë¶€ì—¬ ë° ê±°ë¶€
Â  **ACLì€ iOS / iCloud í‚¤ ì²´ì¸ ì‚¬ìš©í•˜ëŠ” macOS ì•±ì—ì„œëŠ” ì‚¬ìš© ë¶ˆê°€!!!

8. í‚¤ ì²´ì¸ ì„œë¹„ìŠ¤ ì‚¬ìš©ì„ ìœ„í•œ k-ì ‘ë‘ì–´ë€???
Â : ìƒìˆ˜ì˜ ì˜ë¯¸ë¡œ í‘œí˜„ë˜ëŠ”ê²ƒ (ë³€í•˜ì§€ ì•ŠëŠ” ê°’)

9. í‚¤ ì²´ì¸ì—ì„œ k-ì ‘ë‘ì–´ê°€ ë¶™ì€ ê°’ì€ ì–´ë–¤ í”„ë ˆì„ì›Œí¬???
Â : Core Foundation
Â -> í”„ë¡œí¼í‹°ê°€ CFString íƒ€ì…ì´ê³ , í•´ë‹¹ íƒ€ì…ì€ Core Foundationì— í¬í•¨ëœ íƒ€ì…
Â -> Low-Level functionsìœ¼ë¡œ ì›ì‹œ ë°ì´í„° íƒ€ì…ì— ì ‘ê·¼í•˜ì—¬ Foundation í”„ë ˆì„ì›Œí¬ì™€ ì›í™œí•˜ê²Œ ì—°ë™ì‹œì¼œì£¼ëŠ” ê¸°ëŠ¥ì„ í•¨
Â -> Core Foundationì€ iOS ê³„ì¸µì—ì„œ Core Servicesì´ê³  Foundationì€ Cocoa Touch ê³„ì¸µ

- #### [ëŠë‚€ì ]
  ì•„ì´í°ì´ë‚˜ ë§¥ë¶ ì‚¬ìš©ìë¼ë©´ ë¶„ëª… í‚¤ ì²´ì¸ì„ ì ê·¹ í™œìš©í•˜ê³  ìˆë‹¤ê³  ìƒê°í•©ë‹ˆë‹¤. ì–´ë µê³  ë³µì¡í•œ ë§Œí¼ ì• í”Œì—ì„œ ì œê³µí•˜ëŠ” í™•ì‹¤í•˜ê³  ì•ˆì „í•œ ë¯¼ê° ë°ì´í„° ì €ì¥ ë°©ì‹ì„ìœ¼ë¡œ ê¼­ ëŠ¥ìˆ™í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ìµœì„ ì„ ë‹¤í•´ì•¼ê² ìŠµë‹ˆë‹¤.

- #### [ì°¸ê³ ìë£Œ]
  -. ì• í”Œ ê³µì‹ ê°œë°œì ë¬¸ì„œ
  https://developer.apple.com/documentation/security
  https://developer.apple.com/documentation/security/keychain_services/keychain_items
  https://developer.apple.com/documentation/security/keychain_services/keychain_items/using_the_keychain_to_manage_user_secrets
  https://developer.apple.com/documentation/security/keychain_services/keychain_items/adding_a_password_to_the_keychain
  https://developer.apple.com/documentation/security/keychain_services/keychains
  -. ë¸”ë¡œê·¸
  https://daeun28.github.io/iosì‚¬ìš©ë²•/post21/
  https://kor45cw.tistory.com/285
  https://velog.io/@cooo002/iosí‚¤ì²´ì¸Key-Chain

 